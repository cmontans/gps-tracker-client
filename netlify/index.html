<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="3WB Tracker">
  <meta name="theme-color" content="#4F46E5">
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiM1dCIFNwZWVkIFRyYWNrZXIiLCJzaG9ydF9uYW1lIjoiM1dCIFRyYWNrZXIiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzRGNDZFNSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnJTNFJTNDY2lyY2xlIGN4PSc1MCcgY3k9JzUwJyByPSc0MCcgZmlsbD0nJTIzNEY0NkU1Jy8lM0UlM0N0ZXh0IHg9JzUwJyB5PSc2MCcgZm9udC1zaXplPSc0MCcgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nd2hpdGUnJTNF8J+agCUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiMTkyeDE5MiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn0seyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnJTNFJTNDY2lyY2xlIGN4PSc1MCcgY3k9JzUwJyByPSc0MCcgZmlsbD0nJTIzNEY0NkU1Jy8lM0UlM0N0ZXh0IHg9JzUwJyB5PSc2MCcgZm9udC1zaXplPSc0MCcgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nd2hpdGUnJTNF8J+agCUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
  <title>3WB Speed Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          screens: {
            'xs': '475px',
          }
        }
      }
    }
  </script>
  <style>
    body {
      overscroll-behavior: contain;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      user-select: none;
    }
    * {
      box-sizing: border-box;
    }
    @media (display-mode: standalone) {
      body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 m-0 p-0 transition-colors">
  <div id="app" class="min-h-screen p-2 sm:p-4">
    <div class="max-w-7xl mx-auto">
      <!-- Header with Settings -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 mb-4 transition-colors">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 dark:text-white mb-2">ğŸš€ 3WB Speed Tracker</h1>
            <p class="text-sm sm:text-base text-gray-600 dark:text-gray-300">TelemetrÃ­a de velocidad en tiempo real</p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">v4.1 - Modo oscuro, visualizador y pantalla completa âœ“</p>
          </div>
          <div class="flex gap-2">
            <button
              id="dark-mode-toggle"
              class="bg-gray-600 hover:bg-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 text-white px-3 sm:px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
            >
              ğŸŒ™
            </button>
            <button
              id="history-button"
              class="bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-700 dark:hover:bg-indigo-600 text-white px-3 py-2 rounded-lg text-xl transition-colors"
            >
              ğŸ“Š
            </button>
            <button
              id="waypoints-button"
              class="bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 text-white px-3 py-2 rounded-lg text-xl transition-colors"
            >
              ğŸ“
            </button>
            <button
              id="settings-button"
              class="bg-gray-600 hover:bg-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 text-white px-3 py-2 rounded-lg text-xl transition-colors"
            >
              âš™ï¸
            </button>
          </div>
        </div>
        <div id="wake-lock-status" class="hidden mt-2 text-xs">
          <span class="bg-green-100 text-green-800 px-2 py-1 rounded">ğŸ”’ Pantalla bloqueada</span>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto transition-colors">
          <div class="sticky top-0 bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white">âš™ï¸ ConfiguraciÃ³n</h2>
            <button id="close-settings" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl leading-none">
              âœ•
            </button>
          </div>
          <div class="p-4 space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                URL del Servidor WebSocket
              </label>
              <input
                id="server-url"
                type="text"
                value="wss://urban-ricca-cmontans-34613e13.koyeb.app/"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition-colors"
                placeholder="wss://tu-servidor.koyeb.app"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" id="language-label">
                Idioma
              </label>
              <select
                id="language-select"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition-colors"
              >
                <option value="es">EspaÃ±ol</option>
                <option value="en">English</option>
                <option value="fr">FranÃ§ais</option>
                <option value="de">Deutsch</option>
              </select>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <label for="auto-center-toggle" class="text-sm font-medium text-gray-700 dark:text-gray-300" id="auto-center-label">
                Auto-centrar mapa en mi ubicaciÃ³n
              </label>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="auto-center-toggle" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"></div>
              </label>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <label for="voice-enabled-toggle" class="text-sm font-medium text-gray-700 dark:text-gray-300" id="voice-enabled-label">
                ğŸ”Š Anunciar velocidad por voz
              </label>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="voice-enabled-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"></div>
              </label>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <label for="visualizer-mode-toggle" class="text-sm font-medium text-gray-700 dark:text-gray-300" id="visualizer-mode-label">
                ğŸ‘ï¸ Modo Visualizador (solo ver, no publicar)
              </label>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="visualizer-mode-toggle" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"></div>
              </label>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" id="min-speed-label">
                Velocidad mÃ­nima para anunciar (km/h)
              </label>
              <input
                id="min-speed-input"
                type="number"
                value="22"
                min="0"
                max="200"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm transition-colors"
                placeholder="22"
              />
            </div>
            <div class="pt-4 border-t dark:border-gray-700">
              <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                ID: <span id="user-id" class="font-mono text-xs bg-gray-100 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded"></span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- History Modal -->
      <div id="history-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto transition-colors">
          <div class="sticky top-0 bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white">ğŸ“Š Speed History</h2>
            <button id="close-history" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl leading-none">
              âœ•
            </button>
          </div>

          <!-- Statistics Card -->
          <div class="p-4">
            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-gray-700 dark:to-gray-600 rounded-lg p-4 mb-4">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">Statistics</h3>
              <div class="grid grid-cols-3 gap-4">
                <div class="text-center">
                  <p class="text-xs text-gray-600 dark:text-gray-400">Total Records</p>
                  <p id="history-total-records" class="text-2xl font-bold text-gray-800 dark:text-white">0</p>
                </div>
                <div class="text-center">
                  <p class="text-xs text-gray-600 dark:text-gray-400">Highest Speed</p>
                  <p id="history-highest-speed" class="text-2xl font-bold text-red-600 dark:text-red-400">0.0</p>
                  <p class="text-xs text-gray-600 dark:text-gray-400">km/h</p>
                </div>
                <div class="text-center">
                  <p class="text-xs text-gray-600 dark:text-gray-400">Average Max</p>
                  <p id="history-average-max" class="text-2xl font-bold text-green-600 dark:text-green-400">0.0</p>
                  <p class="text-xs text-gray-600 dark:text-gray-400">km/h</p>
                </div>
              </div>
            </div>

            <!-- History Records List -->
            <div>
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">History Records</h3>
              <div id="history-records-container" class="space-y-2 max-h-96 overflow-y-auto">
                <div id="history-loading" class="text-center text-gray-500 dark:text-gray-400 py-8">
                  Loading...
                </div>
                <div id="history-empty" class="hidden text-center text-gray-500 dark:text-gray-400 py-8">
                  No speed history records yet
                </div>
                <div id="history-records-list" class="space-y-2">
                  <!-- Records will be inserted here dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Waypoints Modal -->
      <div id="waypoints-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto transition-colors">
          <div class="sticky top-0 bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white">ğŸ“ Waypoints</h2>
            <button id="close-waypoints" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl leading-none">
              âœ•
            </button>
          </div>

          <div class="p-4 space-y-4">
            <!-- Add Waypoint Button -->
            <div class="flex gap-2">
              <button
                id="add-waypoint-button"
                class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
              >
                â• Add Waypoint
              </button>
              <button
                id="add-waypoint-map-button"
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
              >
                ğŸ—ºï¸ Add on Map
              </button>
            </div>

            <!-- Waypoint Form (hidden by default) -->
            <div id="waypoint-form" class="hidden bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3" id="waypoint-form-title">Create Waypoint</h3>
              <input type="hidden" id="waypoint-form-id">
              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Name</label>
                  <input
                    id="waypoint-name"
                    type="text"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm transition-colors"
                    placeholder="Enter waypoint name..."
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                  <textarea
                    id="waypoint-description"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm transition-colors"
                    rows="2"
                    placeholder="Optional description..."
                  ></textarea>
                </div>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Latitude</label>
                    <input
                      id="waypoint-latitude"
                      type="number"
                      step="0.000001"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm transition-colors"
                      placeholder="0.000000"
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Longitude</label>
                    <input
                      id="waypoint-longitude"
                      type="number"
                      step="0.000001"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm transition-colors"
                      placeholder="0.000000"
                    />
                  </div>
                </div>
                <div class="flex justify-center">
                  <button
                    id="use-current-position-button"
                    type="button"
                    class="bg-blue-500 hover:bg-blue-600 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors"
                  >
                    ğŸ“ Use Current Position
                  </button>
                </div>
                <div class="flex gap-2">
                  <button
                    id="save-waypoint-button"
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
                  >
                    ğŸ’¾ Save
                  </button>
                  <button
                    id="cancel-waypoint-button"
                    class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
                  >
                    âœ• Cancel
                  </button>
                </div>
              </div>
            </div>

            <!-- Waypoints List -->
            <div>
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">Group Waypoints</h3>
              <div id="waypoints-list-container" class="space-y-2 max-h-96 overflow-y-auto">
                <div id="waypoints-loading" class="text-center text-gray-500 dark:text-gray-400 py-8">
                  Loading...
                </div>
                <div id="waypoints-empty" class="hidden text-center text-gray-500 dark:text-gray-400 py-8">
                  No waypoints yet. Create one to get started!
                </div>
                <div id="waypoints-list" class="space-y-2">
                  <!-- Waypoints will be inserted here dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ConfiguraciÃ³n -->
      <div id="config-section" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 mb-4 transition-colors">
        <div class="mb-4">
          <label id="your-name-label" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Tu Nombre
          </label>
          <input
            id="user-name"
            type="text"
            maxlength="20"
            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors"
            placeholder="Ej: Juan, MarÃ­a, Alex..."
          />
          <p id="name-helper" class="text-xs text-gray-500 dark:text-gray-400 mt-1">AsÃ­ te verÃ¡n los demÃ¡s usuarios</p>
        </div>

        <div class="mb-4">
          <label id="group-name-label" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            ğŸ” Nombre del Grupo
          </label>
          <input
            id="group-name"
            type="text"
            maxlength="30"
            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors"
            placeholder="Ej: Amigos, Carrera2024, Familia..."
          />
          <p id="group-helper" class="text-xs text-gray-500 dark:text-gray-400 mt-1">Solo verÃ¡s usuarios de tu mismo grupo</p>
        </div>
        
        <div class="flex gap-2">
          <button
            id="track-button"
            class="flex-1 bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-3 px-6 rounded-lg transition-colors"
          >
            â–¶ï¸ Iniciar Seguimiento
          </button>
        </div>
      </div>

      <!-- Estado y EstadÃ­sticas -->
      <div id="status-section" style="display: none;" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 mb-4 transition-colors">
        <!-- ConexiÃ³n y GPS -->
        <div class="flex items-center justify-between mb-4 flex-wrap gap-2">
          <div class="flex items-center gap-2">
            <span id="wifi-icon" class="text-xl sm:text-2xl">ğŸ“¡</span>
            <span id="connection-status" class="text-xs sm:text-sm font-medium">Desconectado</span>
          </div>
          <div id="gps-status-container" class="flex items-center gap-2">
            <span id="gps-icon" class="text-xl sm:text-2xl">ğŸ“</span>
            <span id="gps-status" class="text-xs sm:text-sm font-medium">GPS Inactivo</span>
          </div>
        </div>

        <!-- Visualizer Mode Indicator -->
        <div id="visualizer-mode-indicator" class="hidden mb-4 p-3 bg-orange-100 dark:bg-orange-900 border-l-4 border-orange-500 rounded">
          <div class="flex items-center">
            <span class="text-xl mr-2">ğŸ‘ï¸</span>
            <span class="text-sm font-bold text-orange-700 dark:text-orange-200" id="visualizer-mode-text">Modo Visualizador Activo</span>
          </div>
          <p class="text-xs text-orange-600 dark:text-orange-300 mt-1">Viendo tracks del grupo sin publicar tu ubicaciÃ³n</p>
        </div>

        <!-- Velocidad y EstadÃ­sticas -->
        <div class="text-center py-4 sm:py-8">
          <div class="mb-4">
            <div id="current-speed-label" class="text-sm text-gray-600 dark:text-gray-400 mb-1">Velocidad Actual</div>
            <div id="speed-display" class="text-5xl sm:text-7xl font-bold text-indigo-600 dark:text-indigo-400 mb-2">0.0</div>
            <div class="text-xl sm:text-2xl text-gray-600 dark:text-gray-400">km/h</div>
          </div>

          <div class="grid grid-cols-2 gap-2 sm:gap-4 mt-6">
            <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900 dark:to-green-800 rounded-lg p-3 sm:p-4 transition-colors">
              <div id="max-session-label" class="text-xs text-green-600 dark:text-green-300 font-semibold mb-1">ğŸ† MÃXIMA SESIÃ“N</div>
              <div id="max-speed" class="text-2xl sm:text-3xl font-bold text-green-700 dark:text-green-200">0.0</div>
              <div class="text-xs sm:text-sm text-green-600 dark:text-green-300">km/h</div>
            </div>
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900 dark:to-blue-800 rounded-lg p-3 sm:p-4 transition-colors">
              <div id="average-label" class="text-xs text-blue-600 dark:text-blue-300 font-semibold mb-1">ğŸ“Š PROMEDIO</div>
              <div id="avg-speed" class="text-2xl sm:text-3xl font-bold text-blue-700 dark:text-blue-200">0.0</div>
              <div class="text-xs sm:text-sm text-blue-600 dark:text-blue-300">km/h</div>
            </div>
          </div>

          <div class="flex gap-2 mt-4">
            <button
              id="reset-stats-button"
              class="flex-1 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
            >
              ğŸ”„ Resetear EstadÃ­sticas
            </button>
            <button
              id="group-horn-button"
              class="flex-1 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors transform active:scale-95"
            >
              ğŸ“¢ Bocina Grupal
            </button>
          </div>
        </div>

        <!-- Mensajes -->
        <div id="error-box" class="hidden mt-4 p-3 bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg text-red-700 dark:text-red-200 text-sm transition-colors"></div>
        <div id="success-box" class="hidden mt-4 p-3 bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-lg text-green-700 dark:text-green-200 text-sm transition-colors"></div>

        <!-- Info GPS -->
        <div id="gps-info" class="hidden mt-4 p-3 bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg text-blue-700 dark:text-blue-200 text-sm transition-colors">
          <p class="mb-1"><strong id="gps-accuracy-label">PrecisiÃ³n GPS:</strong> <span id="accuracy">--</span> <span id="meters-label">metros</span></p>
          <p class="mb-1"><strong id="coordinates-label">Coordenadas:</strong> <span id="coords" class="text-xs break-all">--</span></p>
        </div>

        <!-- BotÃ³n Detener -->
        <div class="mt-6">
          <button
            id="stop-button"
            class="w-full bg-red-600 hover:bg-red-700 active:bg-red-800 text-white font-semibold py-3 px-6 rounded-lg transition-colors text-lg"
          >
            â¹ï¸ Detener seguimiento
          </button>
        </div>
      </div>

      <!-- Usuarios -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 mb-4 transition-colors">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2">
          <h2 id="users-title" class="text-lg sm:text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
            <span class="text-xl sm:text-2xl">ğŸ‘¥</span>
            Usuarios (<span id="user-count">0</span>)
          </h2>
          <button
            id="toggle-map-button"
            class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
          >
            ğŸ—ºï¸ Ver Mapa
          </button>
        </div>
        <div id="users-list" class="space-y-3">
          <p id="no-users-message" class="text-gray-500 dark:text-gray-400 text-center py-8">No hay usuarios conectados</p>
        </div>
      </div>

      <!-- Mapa -->
      <div id="map-container" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 mb-4 transition-colors">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2">
          <h2 id="map-title" class="text-lg sm:text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
            <span class="text-xl sm:text-2xl">ğŸ—ºï¸</span>
            Mapa en Tiempo Real
          </h2>
          <div class="flex flex-wrap gap-2 w-full sm:w-auto">
            <button
              id="fullscreen-button"
              class="flex-1 sm:flex-none bg-purple-600 hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
            >
              â›¶ Pantalla Completa
            </button>
            <button
              id="clear-tracks-button"
              class="flex-1 sm:flex-none bg-orange-600 hover:bg-orange-700 dark:bg-orange-700 dark:hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
            >
              ğŸ—‘ï¸ Limpiar
            </button>
            <button
              id="close-map-button"
              class="flex-1 sm:flex-none bg-gray-600 hover:bg-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
            >
              âœ• Cerrar
            </button>
          </div>
        </div>
        <div id="map" class="w-full h-64 sm:h-96 lg:h-[500px] rounded-lg border-2 border-gray-200 dark:border-gray-700"></div>
        <div class="mt-4 text-xs sm:text-sm text-gray-600 dark:text-gray-400">
          <p id="legend-label" class="font-semibold mb-2">Leyenda:</p>
          <div class="flex flex-wrap gap-3 sm:gap-4">
            <div class="flex items-center gap-2">
              <span class="text-xl sm:text-2xl">ğŸ“</span>
              <span id="your-position-label">Tu posiciÃ³n</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xl sm:text-2xl">ğŸ‘¤</span>
              <span id="other-users-label">Otros usuarios</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="inline-block w-4 h-1 bg-blue-500"></span>
              <span id="trajectory-label">Trayectoria</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Fullscreen Map -->
      <div id="map-fullscreen" class="hidden fixed inset-0 bg-white dark:bg-gray-900 z-50 transition-colors">
        <div class="h-full flex flex-col">
          <div class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-3 flex items-center justify-between">
            <h2 id="map-fullscreen-title" class="text-lg font-bold text-gray-800 dark:text-white">ğŸ—ºï¸ Mapa - Pantalla Completa</h2>
            <button
              id="exit-fullscreen-button"
              class="bg-gray-600 hover:bg-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
            >
              âœ• Salir
            </button>
          </div>
          <div id="map-fullscreen-container" class="flex-1"></div>
        </div>
      </div>

      <!-- Instrucciones -->
      <div class="bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-4 text-sm text-blue-800 dark:text-blue-200 mb-4 transition-colors">
        <p class="font-semibold mb-2">ğŸ’¡ Pasos para usar:</p>
        <ol class="list-decimal list-inside space-y-1">
          <li>Introduce tu nombre</li>
          <li><strong>Introduce el nombre del grupo</strong> (debe ser igual para todos los participantes)</li>
          <li>Activa el GPS en tu mÃ³vil</li>
          <li>Presiona "Iniciar Seguimiento"</li>
          <li>Permite acceso a ubicaciÃ³n cuando te lo pida</li>
          <li>Sal al exterior para mejor seÃ±al GPS</li>
        </ol>
      </div>

      <!-- Info sobre grupos -->
      <div class="bg-purple-50 dark:bg-purple-900 border border-purple-200 dark:border-purple-700 rounded-lg p-4 text-sm text-purple-800 dark:text-purple-200 mb-4 transition-colors">
        <p class="font-semibold mb-2">ğŸ” Sistema de Grupos:</p>
        <ul class="list-disc list-inside space-y-1">
          <li>Solo verÃ¡s usuarios que estÃ©n en tu mismo grupo</li>
          <li>El nombre del grupo distingue mayÃºsculas/minÃºsculas</li>
          <li>Ejemplos: "Amigos", "Carrera2024", "Familia"</li>
          <li>Todos los participantes deben usar el <strong>mismo nombre exacto</strong></li>
        </ul>
      </div>

      <!-- Instrucciones pantalla encendida -->
      <div class="bg-amber-50 dark:bg-amber-900 border border-amber-200 dark:border-amber-700 rounded-lg p-4 text-sm text-amber-800 dark:text-amber-200 mb-4 transition-colors">
        <p class="font-semibold mb-2">âš ï¸ Importante para GPS continuo:</p>
        <ul class="list-disc list-inside space-y-1">
          <li><strong>Android:</strong> La app mantendrÃ¡ la pantalla encendida automÃ¡ticamente. Baja el brillo para ahorrar baterÃ­a.</li>
          <li><strong>iOS:</strong> Ve a Ajustes â†’ Pantalla â†’ Bloqueo automÃ¡tico â†’ "Nunca" mientras usas la app.</li>
          <li><strong>Instalar como app:</strong> Chrome/Safari â†’ MenÃº â†’ "AÃ±adir a pantalla de inicio" para mejor rendimiento.</li>
        </ul>
      </div>

      <!-- Instrucciones iOS -->
      <div id="ios-instructions" class="hidden bg-purple-50 dark:bg-purple-900 border border-purple-200 dark:border-purple-700 rounded-lg p-4 text-sm text-purple-800 dark:text-purple-200 mb-4 transition-colors">
        <p class="font-semibold mb-2">ğŸ Usuarios de iPhone/iPad:</p>
        <ol class="list-decimal list-inside space-y-1">
          <li>Abre esta pÃ¡gina en <strong>Safari</strong> (no Chrome)</li>
          <li>Toca el botÃ³n "Compartir" (cuadrado con flecha arriba)</li>
          <li>Selecciona "AÃ±adir a pantalla de inicio"</li>
          <li>Abre la app desde el icono en tu pantalla</li>
          <li>Ve a Ajustes â†’ Safari â†’ UbicaciÃ³n â†’ "Permitir"</li>
          <li>Ajustes â†’ Privacidad â†’ UbicaciÃ³n â†’ Safari â†’ "Mientras se usa"</li>
        </ol>
      </div>
    </div>

    <!-- Footer: Support by Cool Hot -->
    <footer class="mt-6 py-4 border-t border-gray-200 dark:border-gray-700 text-center">
      <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">Colaboradores</p>
      <div class="flex items-center justify-center gap-3">
        <img
          src="data:image/jpeg;base64,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uO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+7ez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+rez+zxds/kH/LTumvuO+r+yP+zxds/kH/AC07pr7jvq3s/s8XbP5B/wAtO6a+476t7P7PF2z+Qf8ALTumvuO+rez+zxds/kH/AC07pr7jvq3s/s8XbP5B/wAtO6a+476t7P7PF2zkxB/y07pr7jvq3sb1DkTDad4fUvlqiP0uNm/ALdj23DWebeLny7tnvHFfBKYIY4IWxRRtYxuwNaLAKQiIiOIRtrTaebeb0WWBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEH/9k="
          alt="Cool Hot"
          class="h-8 object-contain"
          onerror="this.style.display='none'"
        />
        <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Cool Hot</span>
      </div>
    </footer>
  </div>

  <script>
    console.log('ğŸš€ 3WB Tracker v2.1 iniciado');

    // ==================== TRANSLATIONS ====================
    const translations = {
      es: {
        // Header
        title: 'ğŸš€ 3WB Speed Tracker',
        subtitle: 'TelemetrÃ­a de velocidad en tiempo real',
        version: 'v4.1 - Modo oscuro, visualizador y pantalla completa âœ“',
        settings: 'âš™ï¸',
        screenLocked: 'ğŸ”’ Pantalla bloqueada',

        // Settings Modal
        configuration: 'âš™ï¸ ConfiguraciÃ³n',
        serverUrl: 'URL del Servidor WebSocket',
        serverPlaceholder: 'wss://tu-servidor.koyeb.app',
        language: 'Idioma',
        autoCenterMap: 'Auto-centrar mapa en mi ubicaciÃ³n',
        voiceEnabled: 'ğŸ”Š Anunciar velocidad por voz',
        visualizerMode: 'ğŸ‘ï¸ Modo Visualizador (solo ver, no publicar)',
        visualizerModeActive: 'ğŸ‘ï¸ Modo Visualizador Activo',
        minSpeedLabel: 'Velocidad mÃ­nima para anunciar (km/h)',

        // Config Section
        yourName: 'Tu Nombre',
        namePlaceholder: 'Ej: Juan, MarÃ­a, Alex...',
        nameHelper: 'AsÃ­ te verÃ¡n los demÃ¡s usuarios',
        groupName: 'ğŸ” Nombre del Grupo',
        groupPlaceholder: 'Ej: Amigos, Carrera2024, Familia...',
        groupHelper: 'Solo verÃ¡s usuarios de tu mismo grupo',
        startTracking: 'â–¶ï¸ Iniciar Seguimiento',

        // Status Section
        disconnected: 'Desconectado',
        connected: 'Conectado',
        gpsInactive: 'GPS Inactivo',
        gpsActive: 'GPS Activo',
        currentSpeed: 'Velocidad Actual',
        maxSession: 'ğŸ† MÃXIMA SESIÃ“N',
        average: 'ğŸ“Š PROMEDIO',
        resetStats: 'ğŸ”„ Resetear EstadÃ­sticas',
        groupHorn: 'ğŸ“¢ Bocina Grupal',
        gpsAccuracy: 'PrecisiÃ³n GPS:',
        coordinates: 'Coordenadas:',
        meters: 'metros',
        stopTracking: 'â¹ï¸ Detener seguimiento',

        // Users Section
        users: 'Usuarios',
        viewMap: 'ğŸ—ºï¸ Ver Mapa',
        noUsersConnected: 'No hay usuarios conectados',
        you: 'TÃº',

        // Map Section
        mapRealTime: 'Mapa en Tiempo Real',
        fullscreen: 'â›¶ Pantalla Completa',
        clean: 'ğŸ—‘ï¸ Limpiar',
        close: 'âœ• Cerrar',
        legend: 'Leyenda:',
        yourPosition: 'Tu posiciÃ³n',
        otherUsers: 'Otros usuarios',
        trajectory: 'Trayectoria',
        mapFullscreen: 'ğŸ—ºï¸ Mapa - Pantalla Completa',
        exit: 'âœ• Salir',

        // Instructions
        instructionsTitle: 'ğŸ’¡ Pasos para usar:',
        step1: 'Introduce tu nombre',
        step2: '<strong>Introduce el nombre del grupo</strong> (debe ser igual para todos los participantes)',
        step3: 'Activa el GPS en tu mÃ³vil',
        step4: 'Presiona "Iniciar Seguimiento"',
        step5: 'Permite acceso a ubicaciÃ³n cuando te lo pida',
        step6: 'Sal al exterior para mejor seÃ±al GPS',

        groupSystemTitle: 'ğŸ” Sistema de Grupos:',
        groupInfo1: 'Solo verÃ¡s usuarios que estÃ©n en tu mismo grupo',
        groupInfo2: 'El nombre del grupo distingue mayÃºsculas/minÃºsculas',
        groupInfo3: 'Ejemplos: "Amigos", "Carrera2024", "Familia"',
        groupInfo4: 'Todos los participantes deben usar el <strong>mismo nombre exacto</strong>',

        importantGpsTitle: 'âš ï¸ Importante para GPS continuo:',
        androidInfo: '<strong>Android:</strong> La app mantendrÃ¡ la pantalla encendida automÃ¡ticamente. Baja el brillo para ahorrar baterÃ­a.',
        iosInfo: '<strong>iOS:</strong> Ve a Ajustes â†’ Pantalla â†’ Bloqueo automÃ¡tico â†’ "Nunca" mientras usas la app.',
        installInfo: '<strong>Instalar como app:</strong> Chrome/Safari â†’ MenÃº â†’ "AÃ±adir a pantalla de inicio" para mejor rendimiento.',

        iosInstructionsTitle: 'ğŸ Usuarios de iPhone/iPad:',
        iosStep1: 'Abre esta pÃ¡gina en <strong>Safari</strong> (no Chrome)',
        iosStep2: 'Toca el botÃ³n "Compartir" (cuadrado con flecha arriba)',
        iosStep3: 'Selecciona "AÃ±adir a pantalla de inicio"',
        iosStep4: 'Abre la app desde el icono en tu pantalla',
        iosStep5: 'Ve a Ajustes â†’ Safari â†’ UbicaciÃ³n â†’ "Permitir"',
        iosStep6: 'Ajustes â†’ Privacidad â†’ UbicaciÃ³n â†’ Safari â†’ "Mientras se usa"',

        // Messages
        statsReset: 'âœ“ EstadÃ­sticas reseteadas',
        mustBeTracking: 'âš ï¸ Debes estar en seguimiento para usar la bocina grupal',
        noConnection: 'âš ï¸ No hay conexiÃ³n con el servidor',
        hornActivated: 'ğŸ“¢ Bocina activada para todo el grupo!',
        hornReceived: 'ğŸ“¢ Â¡{name} ha activado la bocina grupal!',
        connectedToServer: 'âœ“ Conectado al servidor',
        tracksCleaned: 'âœ“ Trayectorias limpiadas',
        screenLockedMsg: 'âœ“ Pantalla bloqueada - No se apagarÃ¡',
        connectionError: 'âš ï¸ Error de conexiÃ³n. Verifica el servidor.',
        reconnectError: 'âŒ No se pudo reconectar despuÃ©s de mÃºltiples intentos',
        enterName: 'âš ï¸ Por favor, introduce tu nombre antes de comenzar',
        gpsNotAvailable: 'âŒ GPS no disponible en este dispositivo',
        permissionDenied: 'âŒ Permisos denegados. Ve a ConfiguraciÃ³n â†’ Permisos â†’ UbicaciÃ³n',
        positionUnavailable: 'âš ï¸ GPS no disponible. Sal al exterior.',
        timeout: 'â±ï¸ Tiempo agotado. Verifica que el GPS estÃ© activado.',
        gpsError: 'âŒ Error GPS: ',
        iosWakeLockError: 'iOS: Configura "Bloqueo automÃ¡tico: Nunca" en Ajustes',
        iosScreenError: 'En iOS: Ve a Ajustes â†’ Pantalla â†’ Bloqueo automÃ¡tico â†’ "Nunca"'
      },
      en: {
        // Header
        title: 'ğŸš€ 3WB Speed Tracker',
        subtitle: 'Real-time speed telemetry',
        version: 'v4.1 - Dark mode, viewer and fullscreen âœ“',
        settings: 'âš™ï¸',
        screenLocked: 'ğŸ”’ Screen locked',

        // Settings Modal
        configuration: 'âš™ï¸ Configuration',
        serverUrl: 'WebSocket Server URL',
        serverPlaceholder: 'wss://your-server.koyeb.app',
        language: 'Language',
        autoCenterMap: 'Auto-center map on my location',
        voiceEnabled: 'ğŸ”Š Announce speed by voice',
        visualizerMode: 'ğŸ‘ï¸ Visualizer Mode (view only, don\'t publish)',
        visualizerModeActive: 'ğŸ‘ï¸ Visualizer Mode Active',
        minSpeedLabel: 'Minimum speed to announce (km/h)',

        // Config Section
        yourName: 'Your Name',
        namePlaceholder: 'E.g: John, Mary, Alex...',
        nameHelper: 'This is how others will see you',
        groupName: 'ğŸ” Group Name',
        groupPlaceholder: 'E.g: Friends, Race2024, Family...',
        groupHelper: 'You will only see users in your same group',
        startTracking: 'â–¶ï¸ Start Tracking',

        // Status Section
        disconnected: 'Disconnected',
        connected: 'Connected',
        gpsInactive: 'GPS Inactive',
        gpsActive: 'GPS Active',
        currentSpeed: 'Current Speed',
        maxSession: 'ğŸ† SESSION MAX',
        average: 'ğŸ“Š AVERAGE',
        resetStats: 'ğŸ”„ Reset Statistics',
        groupHorn: 'ğŸ“¢ Group Horn',
        gpsAccuracy: 'GPS Accuracy:',
        coordinates: 'Coordinates:',
        meters: 'meters',
        stopTracking: 'â¹ï¸ Stop tracking',

        // Users Section
        users: 'Users',
        viewMap: 'ğŸ—ºï¸ View Map',
        noUsersConnected: 'No users connected',
        you: 'You',

        // Map Section
        mapRealTime: 'Real-Time Map',
        fullscreen: 'â›¶ Fullscreen',
        clean: 'ğŸ—‘ï¸ Clear',
        close: 'âœ• Close',
        legend: 'Legend:',
        yourPosition: 'Your position',
        otherUsers: 'Other users',
        trajectory: 'Trajectory',
        mapFullscreen: 'ğŸ—ºï¸ Map - Fullscreen',
        exit: 'âœ• Exit',

        // Instructions
        instructionsTitle: 'ğŸ’¡ Steps to use:',
        step1: 'Enter your name',
        step2: '<strong>Enter the group name</strong> (must be the same for all participants)',
        step3: 'Activate GPS on your mobile',
        step4: 'Press "Start Tracking"',
        step5: 'Allow location access when prompted',
        step6: 'Go outside for better GPS signal',

        groupSystemTitle: 'ğŸ” Group System:',
        groupInfo1: 'You will only see users in your same group',
        groupInfo2: 'Group name is case-sensitive',
        groupInfo3: 'Examples: "Friends", "Race2024", "Family"',
        groupInfo4: 'All participants must use the <strong>exact same name</strong>',

        importantGpsTitle: 'âš ï¸ Important for continuous GPS:',
        androidInfo: '<strong>Android:</strong> The app will keep the screen on automatically. Lower brightness to save battery.',
        iosInfo: '<strong>iOS:</strong> Go to Settings â†’ Display â†’ Auto-Lock â†’ "Never" while using the app.',
        installInfo: '<strong>Install as app:</strong> Chrome/Safari â†’ Menu â†’ "Add to home screen" for better performance.',

        iosInstructionsTitle: 'ğŸ iPhone/iPad Users:',
        iosStep1: 'Open this page in <strong>Safari</strong> (not Chrome)',
        iosStep2: 'Tap the "Share" button (square with arrow up)',
        iosStep3: 'Select "Add to Home Screen"',
        iosStep4: 'Open the app from the icon on your screen',
        iosStep5: 'Go to Settings â†’ Safari â†’ Location â†’ "Allow"',
        iosStep6: 'Settings â†’ Privacy â†’ Location â†’ Safari â†’ "While Using"',

        // Messages
        statsReset: 'âœ“ Statistics reset',
        mustBeTracking: 'âš ï¸ You must be tracking to use the group horn',
        noConnection: 'âš ï¸ No connection to server',
        hornActivated: 'ğŸ“¢ Horn activated for the entire group!',
        hornReceived: 'ğŸ“¢ {name} has activated the group horn!',
        connectedToServer: 'âœ“ Connected to server',
        tracksCleaned: 'âœ“ Trajectories cleared',
        screenLockedMsg: 'âœ“ Screen locked - Won\'t turn off',
        connectionError: 'âš ï¸ Connection error. Check the server.',
        reconnectError: 'âŒ Could not reconnect after multiple attempts',
        enterName: 'âš ï¸ Please enter your name before starting',
        gpsNotAvailable: 'âŒ GPS not available on this device',
        permissionDenied: 'âŒ Permission denied. Go to Settings â†’ Permissions â†’ Location',
        positionUnavailable: 'âš ï¸ GPS unavailable. Go outside.',
        timeout: 'â±ï¸ Timeout. Verify that GPS is activated.',
        gpsError: 'âŒ GPS Error: ',
        iosWakeLockError: 'iOS: Configure "Auto-Lock: Never" in Settings',
        iosScreenError: 'On iOS: Go to Settings â†’ Display â†’ Auto-Lock â†’ "Never"'
      },
      fr: {
        // Header
        title: 'ğŸš€ 3WB Speed Tracker',
        subtitle: 'TÃ©lÃ©mÃ©trie de vitesse en temps rÃ©el',
        version: 'v4.1 - Mode sombre, visualiseur et plein Ã©cran âœ“',
        settings: 'âš™ï¸',
        screenLocked: 'ğŸ”’ Ã‰cran verrouillÃ©',

        // Settings Modal
        configuration: 'âš™ï¸ Configuration',
        serverUrl: 'URL du serveur WebSocket',
        serverPlaceholder: 'wss://votre-serveur.koyeb.app',
        language: 'Langue',
        autoCenterMap: 'Centrer automatiquement la carte sur ma position',
        voiceEnabled: 'ğŸ”Š Annoncer la vitesse par voix',
        visualizerMode: 'ğŸ‘ï¸ Mode Visualiseur (voir uniquement, ne pas publier)',
        visualizerModeActive: 'ğŸ‘ï¸ Mode Visualiseur Actif',
        minSpeedLabel: 'Vitesse minimale pour annoncer (km/h)',

        // Config Section
        yourName: 'Votre Nom',
        namePlaceholder: 'Ex: Jean, Marie, Alex...',
        nameHelper: 'C\'est ainsi que les autres vous verront',
        groupName: 'ğŸ” Nom du Groupe',
        groupPlaceholder: 'Ex: Amis, Course2024, Famille...',
        groupHelper: 'Vous ne verrez que les utilisateurs de votre groupe',
        startTracking: 'â–¶ï¸ DÃ©marrer le Suivi',

        // Status Section
        disconnected: 'DÃ©connectÃ©',
        connected: 'ConnectÃ©',
        gpsInactive: 'GPS Inactif',
        gpsActive: 'GPS Actif',
        currentSpeed: 'Vitesse Actuelle',
        maxSession: 'ğŸ† MAX SESSION',
        average: 'ğŸ“Š MOYENNE',
        resetStats: 'ğŸ”„ RÃ©initialiser les Statistiques',
        groupHorn: 'ğŸ“¢ Klaxon de Groupe',
        gpsAccuracy: 'PrÃ©cision GPS:',
        coordinates: 'CoordonnÃ©es:',
        meters: 'mÃ¨tres',
        stopTracking: 'â¹ï¸ ArrÃªter le suivi',

        // Users Section
        users: 'Utilisateurs',
        viewMap: 'ğŸ—ºï¸ Voir la Carte',
        noUsersConnected: 'Aucun utilisateur connectÃ©',
        you: 'Vous',

        // Map Section
        mapRealTime: 'Carte en Temps RÃ©el',
        fullscreen: 'â›¶ Plein Ã‰cran',
        clean: 'ğŸ—‘ï¸ Effacer',
        close: 'âœ• Fermer',
        legend: 'LÃ©gende:',
        yourPosition: 'Votre position',
        otherUsers: 'Autres utilisateurs',
        trajectory: 'Trajectoire',
        mapFullscreen: 'ğŸ—ºï¸ Carte - Plein Ã‰cran',
        exit: 'âœ• Sortir',

        // Instructions
        instructionsTitle: 'ğŸ’¡ Ã‰tapes d\'utilisation:',
        step1: 'Entrez votre nom',
        step2: '<strong>Entrez le nom du groupe</strong> (doit Ãªtre identique pour tous les participants)',
        step3: 'Activez le GPS sur votre mobile',
        step4: 'Appuyez sur "DÃ©marrer le Suivi"',
        step5: 'Autorisez l\'accÃ¨s Ã  la localisation lorsqu\'on vous le demande',
        step6: 'Sortez Ã  l\'extÃ©rieur pour un meilleur signal GPS',

        groupSystemTitle: 'ğŸ” SystÃ¨me de Groupes:',
        groupInfo1: 'Vous ne verrez que les utilisateurs de votre groupe',
        groupInfo2: 'Le nom du groupe est sensible Ã  la casse',
        groupInfo3: 'Exemples: "Amis", "Course2024", "Famille"',
        groupInfo4: 'Tous les participants doivent utiliser le <strong>mÃªme nom exact</strong>',

        importantGpsTitle: 'âš ï¸ Important pour le GPS continu:',
        androidInfo: '<strong>Android:</strong> L\'application maintiendra l\'Ã©cran allumÃ© automatiquement. Baissez la luminositÃ© pour Ã©conomiser la batterie.',
        iosInfo: '<strong>iOS:</strong> Allez dans RÃ©glages â†’ Affichage â†’ Verrouillage auto â†’ "Jamais" pendant l\'utilisation de l\'app.',
        installInfo: '<strong>Installer comme app:</strong> Chrome/Safari â†’ Menu â†’ "Ajouter Ã  l\'Ã©cran d\'accueil" pour de meilleures performances.',

        iosInstructionsTitle: 'ğŸ Utilisateurs iPhone/iPad:',
        iosStep1: 'Ouvrez cette page dans <strong>Safari</strong> (pas Chrome)',
        iosStep2: 'Appuyez sur le bouton "Partager" (carrÃ© avec flÃ¨che vers le haut)',
        iosStep3: 'SÃ©lectionnez "Sur l\'Ã©cran d\'accueil"',
        iosStep4: 'Ouvrez l\'app depuis l\'icÃ´ne sur votre Ã©cran',
        iosStep5: 'Allez dans RÃ©glages â†’ Safari â†’ Localisation â†’ "Autoriser"',
        iosStep6: 'RÃ©glages â†’ ConfidentialitÃ© â†’ Localisation â†’ Safari â†’ "Lorsque l\'app est active"',

        // Messages
        statsReset: 'âœ“ Statistiques rÃ©initialisÃ©es',
        mustBeTracking: 'âš ï¸ Vous devez Ãªtre en suivi pour utiliser le klaxon de groupe',
        noConnection: 'âš ï¸ Pas de connexion au serveur',
        hornActivated: 'ğŸ“¢ Klaxon activÃ© pour tout le groupe!',
        hornReceived: 'ğŸ“¢ {name} a activÃ© le klaxon de groupe!',
        connectedToServer: 'âœ“ ConnectÃ© au serveur',
        tracksCleaned: 'âœ“ Trajectoires effacÃ©es',
        screenLockedMsg: 'âœ“ Ã‰cran verrouillÃ© - Ne s\'Ã©teindra pas',
        connectionError: 'âš ï¸ Erreur de connexion. VÃ©rifiez le serveur.',
        reconnectError: 'âŒ Impossible de se reconnecter aprÃ¨s plusieurs tentatives',
        enterName: 'âš ï¸ Veuillez entrer votre nom avant de commencer',
        gpsNotAvailable: 'âŒ GPS non disponible sur cet appareil',
        permissionDenied: 'âŒ Permission refusÃ©e. Allez dans RÃ©glages â†’ Autorisations â†’ Localisation',
        positionUnavailable: 'âš ï¸ GPS non disponible. Sortez Ã  l\'extÃ©rieur.',
        timeout: 'â±ï¸ DÃ©lai expirÃ©. VÃ©rifiez que le GPS est activÃ©.',
        gpsError: 'âŒ Erreur GPS: ',
        iosWakeLockError: 'iOS: Configurez "Verrouillage auto: Jamais" dans RÃ©glages',
        iosScreenError: 'Sur iOS: Allez dans RÃ©glages â†’ Affichage â†’ Verrouillage auto â†’ "Jamais"'
      },
      de: {
        // Header
        title: 'ğŸš€ 3WB Speed Tracker',
        subtitle: 'Echtzeit-Geschwindigkeitstelemetrie',
        version: 'v4.1 - Dunkelmodus, Viewer und Vollbild âœ“',
        settings: 'âš™ï¸',
        screenLocked: 'ğŸ”’ Bildschirm gesperrt',

        // Settings Modal
        configuration: 'âš™ï¸ Konfiguration',
        serverUrl: 'WebSocket-Server-URL',
        serverPlaceholder: 'wss://ihr-server.koyeb.app',
        language: 'Sprache',
        autoCenterMap: 'Karte automatisch auf meinen Standort zentrieren',
        voiceEnabled: 'ğŸ”Š Geschwindigkeit per Sprache ankÃ¼ndigen',
        visualizerMode: 'ğŸ‘ï¸ Visualisierungsmodus (nur ansehen, nicht verÃ¶ffentlichen)',
        visualizerModeActive: 'ğŸ‘ï¸ Visualisierungsmodus Aktiv',
        minSpeedLabel: 'Mindestgeschwindigkeit zum AnkÃ¼ndigen (km/h)',

        // Config Section
        yourName: 'Ihr Name',
        namePlaceholder: 'Z.B: Hans, Maria, Alex...',
        nameHelper: 'So werden andere Sie sehen',
        groupName: 'ğŸ” Gruppenname',
        groupPlaceholder: 'Z.B: Freunde, Rennen2024, Familie...',
        groupHelper: 'Sie sehen nur Benutzer in Ihrer Gruppe',
        startTracking: 'â–¶ï¸ Tracking Starten',

        // Status Section
        disconnected: 'Getrennt',
        connected: 'Verbunden',
        gpsInactive: 'GPS Inaktiv',
        gpsActive: 'GPS Aktiv',
        currentSpeed: 'Aktuelle Geschwindigkeit',
        maxSession: 'ğŸ† SESSION MAX',
        average: 'ğŸ“Š DURCHSCHNITT',
        resetStats: 'ğŸ”„ Statistiken ZurÃ¼cksetzen',
        groupHorn: 'ğŸ“¢ Gruppen-Hupe',
        gpsAccuracy: 'GPS-Genauigkeit:',
        coordinates: 'Koordinaten:',
        meters: 'Meter',
        stopTracking: 'â¹ï¸ Tracking stoppen',

        // Users Section
        users: 'Benutzer',
        viewMap: 'ğŸ—ºï¸ Karte Anzeigen',
        noUsersConnected: 'Keine Benutzer verbunden',
        you: 'Sie',

        // Map Section
        mapRealTime: 'Echtzeit-Karte',
        fullscreen: 'â›¶ Vollbild',
        clean: 'ğŸ—‘ï¸ LÃ¶schen',
        close: 'âœ• SchlieÃŸen',
        legend: 'Legende:',
        yourPosition: 'Ihre Position',
        otherUsers: 'Andere Benutzer',
        trajectory: 'Trajektorie',
        mapFullscreen: 'ğŸ—ºï¸ Karte - Vollbild',
        exit: 'âœ• Beenden',

        // Instructions
        instructionsTitle: 'ğŸ’¡ Schritte zur Verwendung:',
        step1: 'Geben Sie Ihren Namen ein',
        step2: '<strong>Geben Sie den Gruppennamen ein</strong> (muss fÃ¼r alle Teilnehmer gleich sein)',
        step3: 'Aktivieren Sie GPS auf Ihrem Handy',
        step4: 'DrÃ¼cken Sie "Tracking Starten"',
        step5: 'Erlauben Sie den Standortzugriff, wenn Sie dazu aufgefordert werden',
        step6: 'Gehen Sie nach drauÃŸen fÃ¼r ein besseres GPS-Signal',

        groupSystemTitle: 'ğŸ” Gruppensystem:',
        groupInfo1: 'Sie sehen nur Benutzer in Ihrer Gruppe',
        groupInfo2: 'Beim Gruppennamen wird GroÃŸ-/Kleinschreibung beachtet',
        groupInfo3: 'Beispiele: "Freunde", "Rennen2024", "Familie"',
        groupInfo4: 'Alle Teilnehmer mÃ¼ssen den <strong>exakt gleichen Namen</strong> verwenden',

        importantGpsTitle: 'âš ï¸ Wichtig fÃ¼r kontinuierliches GPS:',
        androidInfo: '<strong>Android:</strong> Die App hÃ¤lt den Bildschirm automatisch an. Reduzieren Sie die Helligkeit, um Batterie zu sparen.',
        iosInfo: '<strong>iOS:</strong> Gehen Sie zu Einstellungen â†’ Anzeige â†’ Automatische Sperre â†’ "Nie" wÃ¤hrend der App-Nutzung.',
        installInfo: '<strong>Als App installieren:</strong> Chrome/Safari â†’ MenÃ¼ â†’ "Zum Startbildschirm hinzufÃ¼gen" fÃ¼r bessere Leistung.',

        iosInstructionsTitle: 'ğŸ iPhone/iPad-Benutzer:',
        iosStep1: 'Ã–ffnen Sie diese Seite in <strong>Safari</strong> (nicht Chrome)',
        iosStep2: 'Tippen Sie auf die SchaltflÃ¤che "Teilen" (Quadrat mit Pfeil nach oben)',
        iosStep3: 'WÃ¤hlen Sie "Zum Home-Bildschirm"',
        iosStep4: 'Ã–ffnen Sie die App Ã¼ber das Symbol auf Ihrem Bildschirm',
        iosStep5: 'Gehen Sie zu Einstellungen â†’ Safari â†’ Standort â†’ "Erlauben"',
        iosStep6: 'Einstellungen â†’ Datenschutz â†’ Standort â†’ Safari â†’ "Beim Verwenden"',

        // Messages
        statsReset: 'âœ“ Statistiken zurÃ¼ckgesetzt',
        mustBeTracking: 'âš ï¸ Sie mÃ¼ssen tracken, um die Gruppen-Hupe zu verwenden',
        noConnection: 'âš ï¸ Keine Verbindung zum Server',
        hornActivated: 'ğŸ“¢ Hupe fÃ¼r die ganze Gruppe aktiviert!',
        hornReceived: 'ğŸ“¢ {name} hat die Gruppen-Hupe aktiviert!',
        connectedToServer: 'âœ“ Mit Server verbunden',
        tracksCleaned: 'âœ“ Trajektorien gelÃ¶scht',
        screenLockedMsg: 'âœ“ Bildschirm gesperrt - Schaltet sich nicht aus',
        connectionError: 'âš ï¸ Verbindungsfehler. ÃœberprÃ¼fen Sie den Server.',
        reconnectError: 'âŒ Konnte nach mehreren Versuchen nicht wieder verbinden',
        enterName: 'âš ï¸ Bitte geben Sie Ihren Namen ein, bevor Sie beginnen',
        gpsNotAvailable: 'âŒ GPS auf diesem GerÃ¤t nicht verfÃ¼gbar',
        permissionDenied: 'âŒ Berechtigung verweigert. Gehen Sie zu Einstellungen â†’ Berechtigungen â†’ Standort',
        positionUnavailable: 'âš ï¸ GPS nicht verfÃ¼gbar. Gehen Sie nach drauÃŸen.',
        timeout: 'â±ï¸ ZeitÃ¼berschreitung. ÃœberprÃ¼fen Sie, ob GPS aktiviert ist.',
        gpsError: 'âŒ GPS-Fehler: ',
        iosWakeLockError: 'iOS: Konfigurieren Sie "Automatische Sperre: Nie" in Einstellungen',
        iosScreenError: 'Auf iOS: Gehen Sie zu Einstellungen â†’ Anzeige â†’ Automatische Sperre â†’ "Nie"'
      }
    };

    // Current language (default: Spanish)
    let currentLanguage = localStorage.getItem('language') || 'es';

    // Translation helper function
    function t(key) {
      return translations[currentLanguage]?.[key] || translations['es'][key] || key;
    }

    // Function to update all UI text
    function updateUILanguage() {
      // Update HTML lang attribute
      document.documentElement.lang = currentLanguage;

      // Update all translatable elements
      document.querySelector('h1').innerHTML = t('title');
      document.querySelectorAll('p.text-sm.sm\\:text-base')[0].textContent = t('subtitle');
      document.querySelectorAll('p.text-xs.text-gray-400')[0].textContent = t('version');
      document.getElementById('settings-button').innerHTML = t('settings');

      // Wake lock status
      const wakeLockSpan = document.querySelector('#wake-lock-status span');
      if (wakeLockSpan) {
        wakeLockSpan.textContent = t('screenLocked');
      }

      // Settings modal
      document.querySelector('#settings-modal h2').innerHTML = t('configuration');
      document.querySelectorAll('#settings-modal label')[0].textContent = t('serverUrl');
      document.getElementById('server-url').placeholder = t('serverPlaceholder');
      elements.languageLabel.textContent = t('language');
      document.getElementById('auto-center-label').textContent = t('autoCenterMap');
      document.getElementById('voice-enabled-label').textContent = t('voiceEnabled');
      document.getElementById('visualizer-mode-label').textContent = t('visualizerMode');
      document.getElementById('min-speed-label').textContent = t('minSpeedLabel');

      // Config section
      document.getElementById('your-name-label').textContent = t('yourName');
      document.getElementById('user-name').placeholder = t('namePlaceholder');
      document.getElementById('name-helper').textContent = t('nameHelper');
      document.getElementById('group-name-label').innerHTML = t('groupName');
      document.getElementById('group-name').placeholder = t('groupPlaceholder');
      document.getElementById('group-helper').textContent = t('groupHelper');

      // Track button
      if (!isTracking) {
        elements.trackButton.textContent = t('startTracking');
      }

      // Status section
      if (elements.connectionStatus.textContent === 'Conectado' || elements.connectionStatus.textContent === 'Connected' ||
          elements.connectionStatus.textContent === 'ConnectÃ©' || elements.connectionStatus.textContent === 'Verbunden') {
        elements.connectionStatus.textContent = t('connected');
      } else {
        elements.connectionStatus.textContent = t('disconnected');
      }

      if (elements.gpsStatus.textContent.includes('Activ') || elements.gpsStatus.textContent.includes('Aktiv')) {
        elements.gpsStatus.textContent = t('gpsActive');
      } else {
        elements.gpsStatus.textContent = t('gpsInactive');
      }

      document.getElementById('current-speed-label').textContent = t('currentSpeed');
      document.getElementById('max-session-label').textContent = t('maxSession');
      document.getElementById('average-label').textContent = t('average');
      document.getElementById('reset-stats-button').innerHTML = t('resetStats');
      document.getElementById('group-horn-button').innerHTML = t('groupHorn');
      document.getElementById('stop-button').innerHTML = t('stopTracking');

      // GPS Info
      const gpsAccuracyLabel = document.getElementById('gps-accuracy-label');
      const coordinatesLabel = document.getElementById('coordinates-label');
      const metersLabel = document.getElementById('meters-label');
      if (gpsAccuracyLabel) gpsAccuracyLabel.textContent = t('gpsAccuracy');
      if (coordinatesLabel) coordinatesLabel.textContent = t('coordinates');
      if (metersLabel) metersLabel.textContent = t('meters');

      // Users section
      const usersTitle = document.getElementById('users-title');
      if (usersTitle) {
        const count = document.getElementById('user-count').textContent;
        usersTitle.innerHTML = `<span class="text-xl sm:text-2xl">ğŸ‘¥</span> ${t('users')} (<span id="user-count">${count}</span>)`;
      }
      const noUsersMsg = document.getElementById('no-users-message');
      if (noUsersMsg) {
        noUsersMsg.textContent = t('noUsersConnected');
      }
      document.getElementById('toggle-map-button').innerHTML = t('viewMap');

      // Map section
      const mapTitle = document.getElementById('map-title');
      if (mapTitle) {
        mapTitle.innerHTML = `<span class="text-xl sm:text-2xl">ğŸ—ºï¸</span> ${t('mapRealTime')}`;
      }
      const mapFullscreenTitle = document.getElementById('map-fullscreen-title');
      if (mapFullscreenTitle) {
        mapFullscreenTitle.textContent = `ğŸ—ºï¸ ${t('mapFullscreen')}`;
      }
      document.getElementById('fullscreen-button').innerHTML = t('fullscreen');
      document.getElementById('clear-tracks-button').innerHTML = t('clean');
      document.getElementById('close-map-button').innerHTML = t('close');
      document.getElementById('exit-fullscreen-button').innerHTML = t('exit');

      // Map legend
      const legendLabel = document.getElementById('legend-label');
      const yourPositionLabel = document.getElementById('your-position-label');
      const otherUsersLabel = document.getElementById('other-users-label');
      const trajectoryLabel = document.getElementById('trajectory-label');
      if (legendLabel) legendLabel.textContent = t('legend');
      if (yourPositionLabel) yourPositionLabel.textContent = t('yourPosition');
      if (otherUsersLabel) otherUsersLabel.textContent = t('otherUsers');
      if (trajectoryLabel) trajectoryLabel.textContent = t('trajectory');

      // Instructions
      const instructionsTitle = document.querySelector('.bg-blue-50 p.font-semibold');
      if (instructionsTitle) {
        instructionsTitle.textContent = t('instructionsTitle');
      }

      const instructionsList = document.querySelectorAll('.bg-blue-50 ol li');
      if (instructionsList.length >= 6) {
        instructionsList[0].textContent = t('step1');
        instructionsList[1].innerHTML = t('step2');
        instructionsList[2].textContent = t('step3');
        instructionsList[3].textContent = t('step4');
        instructionsList[4].textContent = t('step5');
        instructionsList[5].textContent = t('step6');
      }

      // Group system
      const groupTitle = document.querySelector('.bg-purple-50 p.font-semibold');
      if (groupTitle) {
        groupTitle.textContent = t('groupSystemTitle');
      }

      const groupList = document.querySelectorAll('.bg-purple-50 ul li');
      if (groupList.length >= 4) {
        groupList[0].textContent = t('groupInfo1');
        groupList[1].textContent = t('groupInfo2');
        groupList[2].textContent = t('groupInfo3');
        groupList[3].innerHTML = t('groupInfo4');
      }

      // Important GPS info
      const gpsTitle = document.querySelector('.bg-amber-50 p.font-semibold');
      if (gpsTitle) {
        gpsTitle.textContent = t('importantGpsTitle');
      }

      const gpsList = document.querySelectorAll('.bg-amber-50 ul li');
      if (gpsList.length >= 3) {
        gpsList[0].innerHTML = t('androidInfo');
        gpsList[1].innerHTML = t('iosInfo');
        gpsList[2].innerHTML = t('installInfo');
      }

      // iOS instructions
      const iosTitle = document.querySelector('#ios-instructions p.font-semibold');
      if (iosTitle) {
        iosTitle.textContent = t('iosInstructionsTitle');
      }

      const iosList = document.querySelectorAll('#ios-instructions ol li');
      if (iosList.length >= 6) {
        iosList[0].innerHTML = t('iosStep1');
        iosList[1].innerHTML = t('iosStep2');
        iosList[2].innerHTML = t('iosStep3');
        iosList[3].innerHTML = t('iosStep4');
        iosList[4].innerHTML = t('iosStep5');
        iosList[5].innerHTML = t('iosStep6');
      }

      console.log('âœ“ UI language updated to:', currentLanguage);
    }

    // Dark Mode Management
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const html = document.documentElement;

    // FunciÃ³n para actualizar el icono del botÃ³n
    function updateDarkModeIcon(isDark) {
      darkModeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
    }

    // Inicializar el modo oscuro desde localStorage (por defecto: modo oscuro)
    function initDarkMode() {
      const savedTheme = localStorage.getItem('theme');

      // Si no hay preferencia guardada, usar modo oscuro por defecto
      if (!savedTheme) {
        html.classList.add('dark');
        updateDarkModeIcon(true);
        localStorage.setItem('theme', 'dark');
      } else if (savedTheme === 'dark') {
        html.classList.add('dark');
        updateDarkModeIcon(true);
      } else {
        html.classList.remove('dark');
        updateDarkModeIcon(false);
      }
    }

    // Toggle entre modo claro y oscuro
    function toggleDarkMode() {
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateDarkModeIcon(isDark);
    }

    // Event listener para el botÃ³n
    darkModeToggle.addEventListener('click', toggleDarkMode);

    // Inicializar modo oscuro al cargar
    initDarkMode();

    // Detectar iOS
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    
    if (isIOS) {
      document.getElementById('ios-instructions').classList.remove('hidden');
      console.log('ğŸ“± Dispositivo iOS detectado');
    }
    
    // Variables globales
    let userId = localStorage.getItem('userId') || `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    localStorage.setItem('userId', userId);
    
    let userName = localStorage.getItem('userName') || '';
    let groupName = localStorage.getItem('groupName') || '';
    let serverUrl = localStorage.getItem('serverUrl') || 'wss://urban-ricca-cmontans-34613e13.koyeb.app/';
    let voiceEnabled = localStorage.getItem('voiceEnabled') === 'true';
    let visualizerMode = localStorage.getItem('visualizerMode') === 'true';
    let minSpeedThreshold = parseFloat(localStorage.getItem('minSpeedThreshold')) || 22;
    let lastAnnouncedSpeed = -1;
    let lastAnnouncementTime = 0;
    const announcementCooldownMs = 3000; // 3 seconds between announcements
    let ws = null;
    let watchId = null;
    let isTracking = false;
    let users = [];
    let wakeLock = null;
    let reconnectAttempts = 0;
    const MAX_RECONNECT_ATTEMPTS = 10;
    
    // Variables para estadÃ­sticas
    let maxSpeed = 0;
    let speedReadings = [];
    let rejectedReadingsCount = 0;
    let acceptedReadingsCount = 0;

    // GPS Configuration Constants (aligned with Android app)
    const GPS_CONFIG = {
      MAX_GPS_ACCURACY: 10.0,        // meters - reject GPS readings with accuracy worse than this
      MIN_SPEED_THRESHOLD: 1.5,      // km/h - speeds below this are considered stationary
      MAX_SPEED_READINGS: 20,        // number of readings to keep for averaging
      LOCATION_MAX_AGE: 1000,        // ms - cache GPS readings for 1 second (balanced frequency with filtering)
      MS_TO_KMH: 3.6                 // conversion factor
    };

    // Variables para el mapa
    let map = null;
    let mapFullscreen = null;
    let userMarkers = {};
    let userTracks = {};
    let trackPolylines = {};
    let mapVisible = false;
    let isFullscreen = false;

    // Elementos DOM
    const elements = {
      userId: document.getElementById('user-id'),
      userName: document.getElementById('user-name'),
      groupName: document.getElementById('group-name'),
      serverUrl: document.getElementById('server-url'),
      configSection: document.getElementById('config-section'),
      statusSection: document.getElementById('status-section'),
      gpsStatusContainer: document.getElementById('gps-status-container'),
      wifiIcon: document.getElementById('wifi-icon'),
      connectionStatus: document.getElementById('connection-status'),
      gpsIcon: document.getElementById('gps-icon'),
      gpsStatus: document.getElementById('gps-status'),
      speedDisplay: document.getElementById('speed-display'),
      maxSpeed: document.getElementById('max-speed'),
      avgSpeed: document.getElementById('avg-speed'),
      errorBox: document.getElementById('error-box'),
      successBox: document.getElementById('success-box'),
      gpsInfo: document.getElementById('gps-info'),
      trackButton: document.getElementById('track-button'),
      stopButton: document.getElementById('stop-button'),
      resetStatsButton: document.getElementById('reset-stats-button'),
      groupHornButton: document.getElementById('group-horn-button'),
      userCount: document.getElementById('user-count'),
      usersList: document.getElementById('users-list'),
      accuracy: document.getElementById('accuracy'),
      coords: document.getElementById('coords'),
      wakeLockStatus: document.getElementById('wake-lock-status'),
      mapContainer: document.getElementById('map-container'),
      toggleMapButton: document.getElementById('toggle-map-button'),
      closeMapButton: document.getElementById('close-map-button'),
      clearTracksButton: document.getElementById('clear-tracks-button'),
      fullscreenButton: document.getElementById('fullscreen-button'),
      exitFullscreenButton: document.getElementById('exit-fullscreen-button'),
      mapFullscreen: document.getElementById('map-fullscreen'),
      settingsButton: document.getElementById('settings-button'),
      settingsModal: document.getElementById('settings-modal'),
      closeSettings: document.getElementById('close-settings'),
      historyButton: document.getElementById('history-button'),
      historyModal: document.getElementById('history-modal'),
      closeHistory: document.getElementById('close-history'),
      historyTotalRecords: document.getElementById('history-total-records'),
      historyHighestSpeed: document.getElementById('history-highest-speed'),
      historyAverageMax: document.getElementById('history-average-max'),
      historyLoading: document.getElementById('history-loading'),
      historyEmpty: document.getElementById('history-empty'),
      historyRecordsList: document.getElementById('history-records-list'),
      waypointsButton: document.getElementById('waypoints-button'),
      waypointsModal: document.getElementById('waypoints-modal'),
      closeWaypoints: document.getElementById('close-waypoints'),
      addWaypointButton: document.getElementById('add-waypoint-button'),
      addWaypointMapButton: document.getElementById('add-waypoint-map-button'),
      waypointForm: document.getElementById('waypoint-form'),
      waypointFormId: document.getElementById('waypoint-form-id'),
      waypointFormTitle: document.getElementById('waypoint-form-title'),
      waypointName: document.getElementById('waypoint-name'),
      waypointDescription: document.getElementById('waypoint-description'),
      waypointLatitude: document.getElementById('waypoint-latitude'),
      waypointLongitude: document.getElementById('waypoint-longitude'),
      useCurrentPositionButton: document.getElementById('use-current-position-button'),
      saveWaypointButton: document.getElementById('save-waypoint-button'),
      cancelWaypointButton: document.getElementById('cancel-waypoint-button'),
      waypointsLoading: document.getElementById('waypoints-loading'),
      waypointsEmpty: document.getElementById('waypoints-empty'),
      waypointsList: document.getElementById('waypoints-list'),
      languageSelect: document.getElementById('language-select'),
      languageLabel: document.getElementById('language-label'),
      autoCenterToggle: document.getElementById('auto-center-toggle'),
      voiceEnabledToggle: document.getElementById('voice-enabled-toggle'),
      visualizerModeToggle: document.getElementById('visualizer-mode-toggle'),
      visualizerModeIndicator: document.getElementById('visualizer-mode-indicator'),
      visualizerModeText: document.getElementById('visualizer-mode-text'),
      minSpeedInput: document.getElementById('min-speed-input')
    };

    // Inicializar
    elements.userId.textContent = userId.substring(0, 30);
    elements.userName.value = userName;
    elements.groupName.value = groupName;
    elements.serverUrl.value = serverUrl;
    elements.languageSelect.value = currentLanguage;

    // Load auto-center preference (default: true)
    const autoCenterEnabled = localStorage.getItem('autoCenterMap') !== 'false';
    elements.autoCenterToggle.checked = autoCenterEnabled;

    // Load voice announcement preferences
    elements.voiceEnabledToggle.checked = voiceEnabled;
    elements.minSpeedInput.value = minSpeedThreshold;

    // Load visualizer mode preference
    elements.visualizerModeToggle.checked = visualizerMode;

    // Initialize UI language on load
    updateUILanguage();

    // Initialize visualizer mode indicator
    updateVisualizerModeIndicator();

    // VERIFICACIÃ“N CRÃTICA
    console.log('ğŸ” VERIFICACIÃ“N DE ELEMENTOS:');
    console.log('config-section:', !!elements.configSection, elements.configSection);
    console.log('status-section:', !!elements.statusSection, elements.statusSection);
    console.log('track-button:', !!elements.trackButton, elements.trackButton);
    console.log('stop-button:', !!elements.stopButton, elements.stopButton);
    
    if (!elements.stopButton) {
      console.error('âŒ ERROR CRÃTICO: stop-button NO EXISTE en el DOM!');
    } else {
      console.log('âœ… stop-button encontrado correctamente');
    }

    // Guardar nombre cuando cambie
    elements.userName.addEventListener('input', (e) => {
      userName = e.target.value.trim();
      localStorage.setItem('userName', userName);
    });

    // Guardar grupo cuando cambie
    elements.groupName.addEventListener('input', (e) => {
      groupName = e.target.value.trim();
      localStorage.setItem('groupName', groupName);
    });

    // Guardar URL del servidor
    elements.serverUrl.addEventListener('change', (e) => {
      serverUrl = e.target.value.trim();
      localStorage.setItem('serverUrl', serverUrl);
    });

    // Language selector
    elements.languageSelect.addEventListener('change', (e) => {
      currentLanguage = e.target.value;
      localStorage.setItem('language', currentLanguage);
      updateUILanguage();
      console.log('ğŸŒ Language changed to:', currentLanguage);
    });

    // Auto-center toggle
    elements.autoCenterToggle.addEventListener('change', (e) => {
      const isEnabled = e.target.checked;
      localStorage.setItem('autoCenterMap', isEnabled);
      console.log('ğŸ—ºï¸ Auto-center map:', isEnabled ? 'enabled' : 'disabled');
    });

    // Voice announcements toggle
    elements.voiceEnabledToggle.addEventListener('change', (e) => {
      voiceEnabled = e.target.checked;
      localStorage.setItem('voiceEnabled', voiceEnabled);
      console.log('ğŸ”Š Voice announcements:', voiceEnabled ? 'enabled' : 'disabled');
    });

    // Visualizer mode toggle
    elements.visualizerModeToggle.addEventListener('change', (e) => {
      visualizerMode = e.target.checked;
      localStorage.setItem('visualizerMode', visualizerMode);
      console.log('ğŸ‘ï¸ Visualizer mode:', visualizerMode ? 'enabled' : 'disabled');
      updateVisualizerModeIndicator();
    });

    // Min speed threshold
    elements.minSpeedInput.addEventListener('change', (e) => {
      minSpeedThreshold = parseFloat(e.target.value) || 22;
      localStorage.setItem('minSpeedThreshold', minSpeedThreshold);
      console.log('ğŸ¯ Min speed threshold:', minSpeedThreshold, 'km/h');
    });

    // Modal de configuraciÃ³n
    elements.settingsButton.addEventListener('click', () => {
      elements.settingsModal.classList.remove('hidden');
    });

    elements.closeSettings.addEventListener('click', () => {
      elements.settingsModal.classList.add('hidden');
    });

    elements.settingsModal.addEventListener('click', (e) => {
      if (e.target === elements.settingsModal) {
        elements.settingsModal.classList.add('hidden');
      }
    });

    // History modal
    elements.historyButton.addEventListener('click', () => {
      elements.historyModal.classList.remove('hidden');
      loadSpeedHistory();
    });

    elements.closeHistory.addEventListener('click', () => {
      elements.historyModal.classList.add('hidden');
    });

    elements.historyModal.addEventListener('click', (e) => {
      if (e.target === elements.historyModal) {
        elements.historyModal.classList.add('hidden');
      }
    });

    // ============================================
    // WAYPOINTS FUNCTIONALITY
    // ============================================

    let waypoints = [];
    let waypointMarkers = {};
    let isAddingWaypointOnMap = false;
    let mapClickHandler = null;

    // Waypoints modal
    elements.waypointsButton.addEventListener('click', () => {
      elements.waypointsModal.classList.remove('hidden');
      loadWaypoints();
    });

    elements.closeWaypoints.addEventListener('click', () => {
      elements.waypointsModal.classList.add('hidden');
      cancelAddWaypointOnMap();
    });

    elements.waypointsModal.addEventListener('click', (e) => {
      if (e.target === elements.waypointsModal) {
        elements.waypointsModal.classList.add('hidden');
        cancelAddWaypointOnMap();
      }
    });

    // Show waypoint form
    elements.addWaypointButton.addEventListener('click', () => {
      showWaypointForm();
      // Set current user location if available
      const currentUser = users.find(u => u.userId === userId);
      if (currentUser) {
        elements.waypointLatitude.value = currentUser.lat;
        elements.waypointLongitude.value = currentUser.lon;
      }
    });

    // Add waypoint on map
    elements.addWaypointMapButton.addEventListener('click', () => {
      elements.waypointsModal.classList.add('hidden');
      startAddWaypointOnMap();
    });

    // Save waypoint
    elements.saveWaypointButton.addEventListener('click', () => {
      saveWaypoint();
    });

    // Cancel waypoint form
    elements.cancelWaypointButton.addEventListener('click', () => {
      hideWaypointForm();
    });

    // Use current GPS position for waypoint
    elements.useCurrentPositionButton.addEventListener('click', () => {
      const currentUser = users.find(u => u.userId === userId);
      if (currentUser && currentUser.lat && currentUser.lon) {
        elements.waypointLatitude.value = currentUser.lat;
        elements.waypointLongitude.value = currentUser.lon;
        showSuccess('Position updated to current GPS location');
        console.log(`ğŸ“ Waypoint position set to current location: ${currentUser.lat}, ${currentUser.lon}`);
      } else {
        showError('GPS position not available. Please wait for GPS lock or start tracking.');
      }
    });

    // Load waypoints for the current group
    async function loadWaypoints() {
      try {
        elements.waypointsLoading.classList.remove('hidden');
        elements.waypointsEmpty.classList.add('hidden');
        elements.waypointsList.innerHTML = '';

        const httpUrl = serverUrl.replace('wss://', 'https://').replace('ws://', 'http://');
        const response = await fetch(`${httpUrl}/api/waypoints/${groupName}`);

        if (!response.ok) {
          throw new Error('Failed to load waypoints');
        }

        const data = await response.json();
        waypoints = data.waypoints || [];

        elements.waypointsLoading.classList.add('hidden');

        if (waypoints.length === 0) {
          elements.waypointsEmpty.classList.remove('hidden');
        } else {
          renderWaypointsList();
        }

        // Update map markers
        updateWaypointMarkers();
      } catch (error) {
        console.error('âŒ Error loading waypoints:', error);
        elements.waypointsLoading.classList.add('hidden');
        showError('Failed to load waypoints');
      }
    }

    // Render waypoints list
    function renderWaypointsList() {
      elements.waypointsList.innerHTML = waypoints.map(waypoint => `
        <div class="bg-white dark:bg-gray-700 rounded-lg p-3 border border-gray-200 dark:border-gray-600">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800 dark:text-white">${waypoint.name}</h4>
              ${waypoint.description ? `<p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${waypoint.description}</p>` : ''}
              <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                ğŸ“ ${parseFloat(waypoint.latitude).toFixed(6)}, ${parseFloat(waypoint.longitude).toFixed(6)}
              </p>
            </div>
            <div class="flex gap-2 ml-2">
              <button
                onclick="repositionWaypoint(${waypoint.id})"
                class="text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 text-sm font-medium"
                title="Reposition to current location"
              >
                ğŸ“
              </button>
              <button
                onclick="editWaypoint(${waypoint.id})"
                class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-sm font-medium"
              >
                âœï¸
              </button>
              <button
                onclick="deleteWaypoint(${waypoint.id})"
                class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-sm font-medium"
              >
                ğŸ—‘ï¸
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Show waypoint form
    function showWaypointForm(waypoint = null) {
      elements.waypointForm.classList.remove('hidden');
      elements.waypointFormId.value = waypoint ? waypoint.id : '';
      elements.waypointFormTitle.textContent = waypoint ? 'Edit Waypoint' : 'Create Waypoint';
      elements.waypointName.value = waypoint ? waypoint.name : '';
      elements.waypointDescription.value = waypoint ? waypoint.description || '' : '';
      elements.waypointLatitude.value = waypoint ? waypoint.latitude : '';
      elements.waypointLongitude.value = waypoint ? waypoint.longitude : '';
    }

    // Hide waypoint form
    function hideWaypointForm() {
      elements.waypointForm.classList.add('hidden');
      elements.waypointFormId.value = '';
      elements.waypointName.value = '';
      elements.waypointDescription.value = '';
      elements.waypointLatitude.value = '';
      elements.waypointLongitude.value = '';
    }

    // Save waypoint (create or update)
    async function saveWaypoint() {
      try {
        const waypointId = elements.waypointFormId.value;
        const name = elements.waypointName.value.trim();
        const description = elements.waypointDescription.value.trim();
        const latitude = parseFloat(elements.waypointLatitude.value);
        const longitude = parseFloat(elements.waypointLongitude.value);

        if (!name || isNaN(latitude) || isNaN(longitude)) {
          showError('Please fill in all required fields');
          return;
        }

        const httpUrl = serverUrl.replace('wss://', 'https://').replace('ws://', 'http://');
        const isEdit = waypointId !== '';

        const response = await fetch(
          isEdit ? `${httpUrl}/api/waypoints/${waypointId}` : `${httpUrl}/api/waypoints`,
          {
            method: isEdit ? 'PUT' : 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              groupName,
              name,
              description,
              latitude,
              longitude,
              createdBy: userId
            })
          }
        );

        if (!response.ok) {
          throw new Error('Failed to save waypoint');
        }

        showSuccess(isEdit ? 'Waypoint updated!' : 'Waypoint created!');
        hideWaypointForm();
        loadWaypoints();
      } catch (error) {
        console.error('âŒ Error saving waypoint:', error);
        showError('Failed to save waypoint');
      }
    }

    // Edit waypoint (global function for onclick)
    window.editWaypoint = function(waypointId) {
      const waypoint = waypoints.find(w => w.id === waypointId);
      if (waypoint) {
        showWaypointForm(waypoint);
      }
    };

    // Delete waypoint (global function for onclick)
    window.deleteWaypoint = async function(waypointId) {
      if (!confirm('Are you sure you want to delete this waypoint?')) {
        return;
      }

      try {
        const httpUrl = serverUrl.replace('wss://', 'https://').replace('ws://', 'http://');
        const response = await fetch(`${httpUrl}/api/waypoints/${waypointId}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          throw new Error('Failed to delete waypoint');
        }

        showSuccess('Waypoint deleted!');
        loadWaypoints();
      } catch (error) {
        console.error('âŒ Error deleting waypoint:', error);
        showError('Failed to delete waypoint');
      }
    };

    // Reposition waypoint to current GPS location (global function for onclick)
    window.repositionWaypoint = async function(waypointId) {
      const currentUser = users.find(u => u.userId === userId);
      if (!currentUser || !currentUser.lat || !currentUser.lon) {
        showError('GPS position not available. Please wait for GPS lock or start tracking.');
        return;
      }

      const waypoint = waypoints.find(w => w.id === waypointId);
      if (!waypoint) {
        showError('Waypoint not found');
        return;
      }

      if (!confirm(`Reposition "${waypoint.name}" to your current location?`)) {
        return;
      }

      try {
        const httpUrl = serverUrl.replace('wss://', 'https://').replace('ws://', 'http://');
        const response = await fetch(`${httpUrl}/api/waypoints/${waypointId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: waypoint.name,
            description: waypoint.description,
            latitude: currentUser.lat,
            longitude: currentUser.lon
          })
        });

        if (!response.ok) {
          throw new Error('Failed to reposition waypoint');
        }

        showSuccess(`Waypoint "${waypoint.name}" repositioned to current location!`);
        console.log(`ğŸ“ Waypoint repositioned: ${waypoint.name} to ${currentUser.lat}, ${currentUser.lon}`);
        loadWaypoints();
      } catch (error) {
        console.error('âŒ Error repositioning waypoint:', error);
        showError('Failed to reposition waypoint');
      }
    };

    // Start adding waypoint on map
    function startAddWaypointOnMap() {
      isAddingWaypointOnMap = true;
      showSuccess('Click on the map to add a waypoint');

      const activeMap = isFullscreen ? mapFullscreen : map;
      if (!activeMap) {
        showError('Please open the map first');
        return;
      }

      // Create map click handler
      mapClickHandler = function(e) {
        const lat = e.latlng.lat;
        const lon = e.latlng.lng;

        // Show waypoint form with coordinates
        elements.waypointsModal.classList.remove('hidden');
        showWaypointForm();
        elements.waypointLatitude.value = lat;
        elements.waypointLongitude.value = lon;

        // Remove map click handler
        cancelAddWaypointOnMap();
      };

      activeMap.on('click', mapClickHandler);
    }

    // Cancel adding waypoint on map
    function cancelAddWaypointOnMap() {
      if (isAddingWaypointOnMap) {
        isAddingWaypointOnMap = false;
        const activeMap = isFullscreen ? mapFullscreen : map;
        if (activeMap && mapClickHandler) {
          activeMap.off('click', mapClickHandler);
          mapClickHandler = null;
        }
      }
    }

    // Update waypoint markers on map
    function updateWaypointMarkers() {
      const activeMap = isFullscreen ? mapFullscreen : map;
      if (!activeMap) return;

      // Remove old waypoint markers
      Object.values(waypointMarkers).forEach(marker => {
        if (marker && activeMap.hasLayer(marker)) {
          activeMap.removeLayer(marker);
        }
      });
      waypointMarkers = {};

      // Add new waypoint markers
      waypoints.forEach(waypoint => {
        try {
          const icon = L.divIcon({
            className: 'waypoint-marker',
            html: `<div style="text-align: center;">
              <div style="font-size: 24px;">ğŸ“</div>
              <div style="background: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                ${waypoint.name}
              </div>
            </div>`,
            iconSize: [60, 40],
            iconAnchor: [30, 40]
          });

          const marker = L.marker([waypoint.latitude, waypoint.longitude], { icon: icon })
            .addTo(activeMap);

          marker.bindPopup(`
            <div style="text-align: center; min-width: 150px;">
              <strong style="font-size: 14px;">${waypoint.name}</strong><br>
              ${waypoint.description ? `<p style="font-size: 12px; color: #666; margin: 4px 0;">${waypoint.description}</p>` : ''}
              <span style="font-size: 11px; color: #888;">ğŸ“ ${parseFloat(waypoint.latitude).toFixed(6)}, ${parseFloat(waypoint.longitude).toFixed(6)}</span>
            </div>
          `);

          waypointMarkers[waypoint.id] = marker;
        } catch (error) {
          console.error('âŒ Error creating waypoint marker:', error);
        }
      });
    }

    // ============================================
    // END WAYPOINTS FUNCTIONALITY
    // ============================================

    // Resetear estadÃ­sticas
    elements.resetStatsButton.addEventListener('click', () => {
      maxSpeed = 0;
      speedReadings = [];
      elements.maxSpeed.textContent = '0.0';
      elements.avgSpeed.textContent = '0.0';
      showSuccess(t('statsReset'));
      console.log('ğŸ”„ EstadÃ­sticas reseteadas');
    });

    // FunciÃ³n para generar y reproducir sonido de bocina potente
    function playHornSound() {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Crear osciladores para un sonido de bocina mÃ¡s realista y potente
        const oscillator1 = audioContext.createOscillator();
        const oscillator2 = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        // Frecuencias de bocina de auto (mÃ¡s graves y potentes)
        oscillator1.type = 'sawtooth';
        oscillator1.frequency.setValueAtTime(220, audioContext.currentTime); // A3

        oscillator2.type = 'sawtooth';
        oscillator2.frequency.setValueAtTime(330, audioContext.currentTime); // E4

        // Conectar osciladores al gain
        oscillator1.connect(gainNode);
        oscillator2.connect(gainNode);
        gainNode.connect(audioContext.destination);

        // Volumen inicial alto con fade out
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(0.8, audioContext.currentTime + 0.05); // Ataque rÃ¡pido
        gainNode.gain.exponentialRampToValueAtTime(0.6, audioContext.currentTime + 0.5); // Sostener
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.5); // Fade out

        // Iniciar sonido
        oscillator1.start(audioContext.currentTime);
        oscillator2.start(audioContext.currentTime);

        // Detener despuÃ©s de 1.5 segundos
        oscillator1.stop(audioContext.currentTime + 1.5);
        oscillator2.stop(audioContext.currentTime + 1.5);

        console.log('ğŸ“¢ Bocina reproducida');
      } catch (error) {
        console.error('âŒ Error reproduciendo bocina:', error);
        showError('Error al reproducir bocina: ' + error.message);
      }
    }

    // Voice speed announcement function
    function announceSpeed(speed) {
      if (!voiceEnabled || !('speechSynthesis' in window)) {
        return;
      }

      const speedInt = Math.round(speed);

      // Check if speed is above threshold
      if (speedInt < minSpeedThreshold) {
        return;
      }

      // Check cooldown
      const currentTime = Date.now();
      if (speedInt === lastAnnouncedSpeed ||
          (currentTime - lastAnnouncementTime) < announcementCooldownMs) {
        return;
      }

      // Stop any ongoing speech
      if (window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
      }

      // Create and speak the announcement
      const utterance = new SpeechSynthesisUtterance(speedInt.toString());

      // Set language based on current language
      const langMap = {
        'es': 'es-ES',
        'en': 'en-US',
        'fr': 'fr-FR',
        'de': 'de-DE'
      };
      utterance.lang = langMap[currentLanguage] || 'en-US';
      utterance.rate = 1.0;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;

      window.speechSynthesis.speak(utterance);

      // Update tracking variables
      lastAnnouncedSpeed = speedInt;
      lastAnnouncementTime = currentTime;

      console.log('ğŸ”Š Speed announced:', speedInt, 'km/h');
    }

    // BotÃ³n de bocina grupal
    elements.groupHornButton.addEventListener('click', () => {
      if (!isTracking) {
        showError(t('mustBeTracking'));
        return;
      }

      if (!ws || ws.readyState !== WebSocket.OPEN) {
        showError(t('noConnection'));
        return;
      }

      // Enviar seÃ±al de bocina a todos los usuarios del grupo
      ws.send(JSON.stringify({
        type: 'group-horn',
        userId,
        userName: userName || 'Usuario',
        groupName: groupName || 'default',
        timestamp: Date.now()
      }));

      // Reproducir sonido localmente tambiÃ©n
      playHornSound();
      showSuccess(t('hornActivated'));
      console.log('ğŸ“¢ SeÃ±al de bocina enviada al grupo:', groupName || 'default');
    });

    // Inicializar mapa con Leaflet (OpenStreetMap)
    function initMap(lat, lon, container = 'map') {
      const targetMap = container === 'map-fullscreen-container' ? 'mapFullscreen' : 'map';
      
      if (eval(targetMap)) return; // Ya estÃ¡ inicializado
      
      const mapInstance = L.map(container).setView([lat, lon], 15);
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        maxZoom: 19
      }).addTo(mapInstance);
      
      if (targetMap === 'mapFullscreen') {
        mapFullscreen = mapInstance;
      } else {
        map = mapInstance;
      }
      
      console.log('âœ“ Mapa inicializado:', container);
    }

    // Calcular Ã¡ngulo de direcciÃ³n entre dos puntos
    function calculateBearing(lat1, lon1, lat2, lon2) {
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const y = Math.sin(dLon) * Math.cos(lat2 * Math.PI / 180);
      const x = Math.cos(lat1 * Math.PI / 180) * Math.sin(lat2 * Math.PI / 180) -
                Math.sin(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.cos(dLon);
      const bearing = Math.atan2(y, x) * 180 / Math.PI;
      return (bearing + 360) % 360;
    }

    // Crear icono de flecha para direcciÃ³n con velocidad y nombre visible
    function createArrowIcon(speed, isCurrentUser, bearing = 0, userName = '') {
      const color = isCurrentUser ? '#4F46E5' : '#10B981';
      const size = isCurrentUser ? 40 : 35;
      const displayName = userName || 'Usuario';

      const html = `
        <div style="position: relative; width: ${size}px; height: ${size}px; display: flex; align-items: center; justify-content: center;">
          <div style="position: absolute; top: -45px; left: 50%; transform: translateX(-50%); background: ${color}; color: white; padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: bold; white-space: nowrap; box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 1000; text-align: center; line-height: 1.3;">
            <div style="font-size: 10px; opacity: 0.9;">${displayName}</div>
            <div style="font-size: 13px; margin-top: 1px;">${parseFloat(speed).toFixed(1)} km/h</div>
          </div>
          <svg width="${size}" height="${size}" viewBox="0 0 24 24" style="transform: rotate(${bearing}deg); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));">
            <path d="M12 2 L4 20 L12 16 L20 20 Z" fill="${color}" stroke="white" stroke-width="1.5"/>
          </svg>
        </div>
      `;

      return L.divIcon({
        html: html,
        className: '',
        iconSize: [size, size],
        iconAnchor: [size/2, size/2],
        popupAnchor: [0, -size/2]
      });
    }

    // Actualizar mapa con posiciones de usuarios
    function updateMap() {
      const activeMap = isFullscreen ? mapFullscreen : map;
      if (!activeMap || (!mapVisible && !isFullscreen)) return;

      console.log('ğŸ—ºï¸ Actualizando mapa con', users.length, 'usuarios');

      users.forEach(user => {
        const isCurrentUser = user.userId === userId;
        const markerId = user.userId + (isFullscreen ? '_fs' : '_normal');
        
        console.log('ğŸ“ Procesando usuario:', user.userName || user.userId, 'Pos:', user.lat, user.lon);
        
        // Crear o actualizar marcador
        if (!userMarkers[markerId]) {
          console.log('âœ¨ Creando nuevo marcador para:', markerId);

          try {
            const displayName = user.userName || user.userId.substring(0, 15);
            const icon = createArrowIcon(user.speed, isCurrentUser, user.bearing || 0, displayName);
            const marker = L.marker([user.lat, user.lon], { icon: icon }).addTo(activeMap);

            marker.bindPopup(`
              <div style="text-align: center;">
                <strong>${displayName}</strong><br>
                <span style="font-size: 18px; font-weight: bold;">${parseFloat(user.speed).toFixed(1)} km/h</span><br>
                <span style="font-size: 14px;">ğŸ† Max: ${parseFloat(user.maxSpeed || 0).toFixed(1)} km/h</span><br>
                <span style="font-size: 11px; color: #666;">${new Date(user.timestamp).toLocaleTimeString()}</span>
              </div>
            `);

            userMarkers[markerId] = marker;
            userTracks[markerId] = [];

            console.log('âœ… Marcador creado exitosamente');
          } catch (error) {
            console.error('âŒ Error creando marcador:', error);
          }
        } else {
          // Actualizar posiciÃ³n y rotaciÃ³n
          try {
            const displayName = user.userName || user.userId.substring(0, 15);
            const marker = userMarkers[markerId];
            marker.setLatLng([user.lat, user.lon]);
            marker.setIcon(createArrowIcon(user.speed, isCurrentUser, user.bearing || 0, displayName));

            marker.setPopupContent(`
              <div style="text-align: center;">
                <strong>${displayName}</strong><br>
                <span style="font-size: 18px; font-weight: bold;">${parseFloat(user.speed).toFixed(1)} km/h</span><br>
                <span style="font-size: 14px;">ğŸ† Max: ${parseFloat(user.maxSpeed || 0).toFixed(1)} km/h</span><br>
                <span style="font-size: 11px; color: #666;">${new Date(user.timestamp).toLocaleTimeString()}</span>
              </div>
            `);
          } catch (error) {
            console.error('âŒ Error actualizando marcador:', error);
          }
        }
        
        // Agregar punto a la trayectoria solo si velocidad > 3.6 km/h
        if (user.speed > 3.6) {
          const track = userTracks[markerId];
          if (track) {
            track.push([user.lat, user.lon]);
            
            if (track.length > 50) {
              track.shift();
            }
            
            const polylineId = markerId + '_polyline';
            if (trackPolylines[polylineId]) {
              activeMap.removeLayer(trackPolylines[polylineId]);
            }
            
            if (track.length > 1) {
              const color = isCurrentUser ? '#4F46E5' : '#10B981';
              try {
                trackPolylines[polylineId] = L.polyline(track, {
                  color: color,
                  weight: 3,
                  opacity: 0.7,
                  smoothFactor: 1
                }).addTo(activeMap);
              } catch (error) {
                console.error('âŒ Error dibujando polyline:', error);
              }
            }
          }
        }
      });

      // Eliminar marcadores de usuarios desconectados
      Object.keys(userMarkers).forEach(markerId => {
        const userId = markerId.replace('_fs', '').replace('_normal', '');
        const mapType = markerId.includes('_fs') ? 'fs' : 'normal';
        
        if (!users.find(u => u.userId === userId) || 
            (isFullscreen && mapType === 'normal') || 
            (!isFullscreen && mapType === 'fs')) {
          try {
            activeMap.removeLayer(userMarkers[markerId]);
            delete userMarkers[markerId];
            delete userTracks[markerId];
            
            const polylineId = markerId + '_polyline';
            if (trackPolylines[polylineId]) {
              activeMap.removeLayer(trackPolylines[polylineId]);
              delete trackPolylines[polylineId];
            }
          } catch (error) {
            console.error('âŒ Error eliminando marcador:', error);
          }
        }
      });

      // Centrar en el usuario actual si existe y auto-center estÃ¡ habilitado
      const currentUser = users.find(u => u.userId === userId);
      const autoCenterEnabled = localStorage.getItem('autoCenterMap') !== 'false';
      if (currentUser && autoCenterEnabled) {
        activeMap.setView([currentUser.lat, currentUser.lon], activeMap.getZoom());
      }
    }

    // Limpiar tracks del mapa
    function clearMapTracks() {
      const activeMap = isFullscreen ? mapFullscreen : map;
      if (!activeMap) return;

      // Eliminar todas las polylines
      Object.keys(trackPolylines).forEach(uid => {
        if (trackPolylines[uid]) {
          activeMap.removeLayer(trackPolylines[uid]);
          delete trackPolylines[uid];
        }
      });

      // Vaciar arrays de tracks
      Object.keys(userTracks).forEach(uid => {
        userTracks[uid] = [];
      });

      showSuccess(t('tracksCleaned'));
      console.log('ğŸ—‘ï¸ Tracks del mapa limpiados');
    }

    // Toggle mapa
    elements.toggleMapButton.addEventListener('click', () => {
      mapVisible = true;
      elements.mapContainer.classList.remove('hidden');

      // Inicializar mapa con posiciÃ³n del primer usuario disponible
      const firstUser = users.length > 0 ? users[0] : null;
      if (firstUser) {
        initMap(firstUser.lat, firstUser.lon);
        updateMap();
      } else if (users.length === 0) {
        initMap(40.4168, -3.7038); // Madrid por defecto
      }

      // Ajustar tamaÃ±o del mapa y actualizar waypoints
      setTimeout(() => {
        if (map) {
          map.invalidateSize();
          updateWaypointMarkers();
        }
      }, 100);
    });

    elements.closeMapButton.addEventListener('click', () => {
      mapVisible = false;
      elements.mapContainer.classList.add('hidden');
    });

    // Pantalla completa
    elements.fullscreenButton.addEventListener('click', () => {
      isFullscreen = true;
      elements.mapContainer.classList.add('hidden'); // Ocultar mapa normal
      elements.mapFullscreen.classList.remove('hidden');

      const firstUser = users.length > 0 ? users[0] : null;
      if (firstUser) {
        initMap(firstUser.lat, firstUser.lon, 'map-fullscreen-container');
        setTimeout(() => {
          updateMap();
          updateWaypointMarkers();
        }, 200);
      } else {
        initMap(40.4168, -3.7038, 'map-fullscreen-container');
      }

      setTimeout(() => {
        if (mapFullscreen) {
          mapFullscreen.invalidateSize();
          updateWaypointMarkers();
        }
      }, 100);
    });

    elements.exitFullscreenButton.addEventListener('click', () => {
      isFullscreen = false;
      elements.mapFullscreen.classList.add('hidden');
      elements.mapContainer.classList.remove('hidden'); // Mostrar mapa normal
      
      // Limpiar marcadores del mapa fullscreen
      Object.keys(userMarkers).forEach(markerId => {
        if (markerId.includes('_fs') && mapFullscreen) {
          mapFullscreen.removeLayer(userMarkers[markerId]);
          delete userMarkers[markerId];
          delete userTracks[markerId];
          
          const polylineId = `${markerId}_polyline`;
          if (trackPolylines[polylineId]) {
            mapFullscreen.removeLayer(trackPolylines[polylineId]);
            delete trackPolylines[polylineId];
          }
        }
      });
      
      // Actualizar mapa normal
      setTimeout(() => {
        if (map) {
          map.invalidateSize();
          updateMap();
          updateWaypointMarkers();
        }
      }, 100);
    });

    // Limpiar tracks
    elements.clearTracksButton.addEventListener('click', () => {
      clearMapTracks();
    });

    // Wake Lock API - Mantener pantalla encendida
    async function requestWakeLock() {
      if (!('wakeLock' in navigator)) {
        console.log('âš ï¸ Wake Lock no soportado en este navegador');
        if (isIOS) {
          showError(t('iosScreenError'));
        }
        return;
      }

      try {
        wakeLock = await navigator.wakeLock.request('screen');
        console.log('âœ“ Wake Lock activado - Pantalla se mantendrÃ¡ encendida');
        elements.wakeLockStatus.classList.remove('hidden');
        showSuccess(t('screenLockedMsg'));

        wakeLock.addEventListener('release', () => {
          console.log('Wake Lock liberado');
          elements.wakeLockStatus.classList.add('hidden');
        });
      } catch (err) {
        console.log('âŒ Wake Lock error:', err);
        if (isIOS) {
          showError(t('iosWakeLockError'));
        }
      }
    }

    // Liberar Wake Lock
    function releaseWakeLock() {
      if (wakeLock) {
        wakeLock.release().then(() => {
          wakeLock = null;
          elements.wakeLockStatus.classList.add('hidden');
          console.log('âœ“ Wake Lock liberado');
        });
      }
    }

    // Re-adquirir Wake Lock cuando la pÃ¡gina vuelve a estar visible
    document.addEventListener('visibilitychange', async () => {
      if (isTracking && !document.hidden && wakeLock === null) {
        console.log('â†» Reactivando Wake Lock...');
        await requestWakeLock();
      }
    });

    // Prevenir que el navegador pause la app
    let keepAliveInterval = null;
    function startKeepAlive() {
      // Ping cada 25 segundos para mantener la conexiÃ³n activa
      keepAliveInterval = setInterval(() => {
        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify({ type: 'ping' }));
          console.log('ğŸ’“ Keep-alive ping');
        }
      }, 25000);
    }

    function stopKeepAlive() {
      if (keepAliveInterval) {
        clearInterval(keepAliveInterval);
        keepAliveInterval = null;
      }
    }

    // Mostrar error
    function showError(message) {
      console.error('âŒ', message);
      elements.errorBox.textContent = message;
      elements.errorBox.classList.remove('hidden');
      elements.successBox.classList.add('hidden');
      setTimeout(() => elements.errorBox.classList.add('hidden'), 8000);
    }

    // Mostrar Ã©xito
    function showSuccess(message) {
      console.log('âœ“', message);
      elements.successBox.textContent = message;
      elements.successBox.classList.remove('hidden');
      elements.errorBox.classList.add('hidden');
      setTimeout(() => elements.successBox.classList.add('hidden'), 3000);
    }

    // Actualizar estado de conexiÃ³n
    function updateConnectionStatus(connected) {
      elements.wifiIcon.textContent = connected ? 'âœ…' : 'âŒ';
      elements.connectionStatus.textContent = connected ? t('connected') : t('disconnected');
      elements.connectionStatus.className = `text-sm font-medium ${connected ? 'text-green-600' : 'text-red-600'}`;
    }

    // Actualizar estado GPS
    function updateGpsStatus(active) {
      elements.gpsIcon.textContent = active ? 'âœ…' : 'ğŸ“';
      elements.gpsStatus.textContent = active ? t('gpsActive') : t('gpsInactive');
      elements.gpsStatus.className = `text-sm font-medium ${active ? 'text-green-600' : 'text-gray-600'}`;
    }

    // Actualizar indicador de modo visualizador
    function updateVisualizerModeIndicator() {
      if (visualizerMode) {
        elements.visualizerModeIndicator.classList.remove('hidden');
        elements.visualizerModeText.textContent = t('visualizerModeActive');
      } else {
        elements.visualizerModeIndicator.classList.add('hidden');
      }
    }

    // Conectar WebSocket con reconexiÃ³n mejorada
    function connectWebSocket() {
      const serverUrl = elements.serverUrl.value;
      console.log('ğŸ”Œ Conectando a:', serverUrl);
      
      try {
        ws = new WebSocket(serverUrl);
        
        ws.onopen = () => {
          updateConnectionStatus(true);
          showSuccess(t('connectedToServer'));
          reconnectAttempts = 0;

          ws.send(JSON.stringify({
            type: 'register',
            userId,
            userName: userName || 'Usuario',
            groupName: groupName || 'default'
          }));
          console.log('âœ“ Registrado en servidor - Grupo:', groupName || 'default');

          startKeepAlive();
        };

        ws.onmessage = (event) => {
          const data = JSON.parse(event.data);
          if (data.type === 'users') {
            users = data.users;
            updateUsersList();
            updateMap();
          } else if (data.type === 'pong') {
            console.log('ğŸ’“ Pong recibido');
          } else if (data.type === 'group-horn') {
            // Recibir seÃ±al de bocina de otro usuario del grupo
            const senderName = data.userName || 'Usuario';
            console.log('ğŸ“¢ Bocina recibida de:', senderName);

            // Solo reproducir si no es el usuario actual quien la enviÃ³
            if (data.userId !== userId) {
              playHornSound();
              showSuccess(t('hornReceived').replace('{name}', senderName));
            }
          }
        };

        ws.onerror = (error) => {
          console.error('âŒ Error WebSocket:', error);
          showError(t('connectionError'));
          updateConnectionStatus(false);
        };

        ws.onclose = () => {
          console.log('ğŸ”Œ ConexiÃ³n cerrada');
          updateConnectionStatus(false);
          stopKeepAlive();

          if (isTracking && reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
            reconnectAttempts++;
            const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
            console.log(`â†» Reconectando en ${delay/1000}s (intento ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})`);
            setTimeout(connectWebSocket, delay);
          } else if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {
            showError(t('reconnectError'));
          }
        };
      } catch (error) {
        console.error('âŒ Error al crear WebSocket:', error);
        showError('No se pudo conectar: ' + error.message);
      }
    }

    // Actualizar lista de usuarios
    function updateUsersList() {
      elements.userCount.textContent = users.length;

      if (users.length === 0) {
        elements.usersList.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center py-8">${t('noUsersConnected')}</p>`;
        return;
      }

      elements.usersList.innerHTML = users.map(user => {
        const displayName = user.userName || user.userId.substring(0, 15);
        const isCurrentUser = user.userId === userId;

        // Calcular direcciÃ³n en texto
        let direction = '';
        if (user.bearing !== undefined) {
          const dirs = ['N', 'NE', 'E', 'SE', 'S', 'SO', 'O', 'NO'];
          const index = Math.round(user.bearing / 45) % 8;
          direction = dirs[index];
        }

        return `
        <div class="p-4 rounded-lg border-2 ${isCurrentUser ? 'bg-indigo-50 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-700' : 'bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600'} transition-colors">
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-1">
                <span class="text-lg font-semibold text-gray-800 dark:text-white">${displayName}</span>
                ${isCurrentUser ? `<span class="text-xs bg-indigo-500 dark:bg-indigo-600 text-white px-2 py-1 rounded-full">${t('you')}</span>` : ''}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400 font-mono truncate">
                ID: ${user.userId.substring(0, 20)}...
              </div>
              <div class="flex items-center gap-3 mt-2 text-sm text-gray-600 dark:text-gray-400">
                <span>ğŸ§­ ${direction || '--'}</span>
                <span>ğŸ† ${parseFloat(user.maxSpeed || 0).toFixed(1)} km/h</span>
                <span class="text-xs">${new Date(user.timestamp).toLocaleTimeString()}</span>
              </div>
            </div>
            <div class="text-right ml-4">
              <div class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">${parseFloat(user.speed).toFixed(1)}</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">km/h</div>
            </div>
          </div>
        </div>
      `}).join('');
    }

    // Iniciar seguimiento GPS
    function startTracking() {
      console.log('ğŸ¯ Iniciando seguimiento GPS...');

      // Validar nombre
      if (!userName || userName.trim() === '') {
        showError(t('enterName'));
        elements.userName.focus();
        return;
      }

      if (!navigator.geolocation) {
        showError(t('gpsNotAvailable'));
        return;
      }

      // Cambiar visibilidad
      elements.statusSection.classList.remove('hidden');
      elements.statusSection.style.display = 'block';
      elements.configSection.classList.add('hidden');
      elements.configSection.style.display = 'none';
      connectWebSocket();

      const options = {
        enableHighAccuracy: true,
        timeout: 15000,
        maximumAge: GPS_CONFIG.LOCATION_MAX_AGE  // Allow 1s cached positions for balanced update frequency
      };

      let lastPosition = null;

      watchId = navigator.geolocation.watchPosition(
        (position) => {
          // Filter out inaccurate GPS readings
          const accuracy = position.coords.accuracy;
          if (accuracy >= GPS_CONFIG.MAX_GPS_ACCURACY) {
            rejectedReadingsCount++;
            console.warn(`âŒ REJECTED GPS reading #${rejectedReadingsCount}: accuracy=${accuracy.toFixed(1)}m (threshold: ${GPS_CONFIG.MAX_GPS_ACCURACY}m)`);
            return;
          }

          // Reading accepted
          acceptedReadingsCount++;
          console.log(`âœ“ Accepted GPS reading #${acceptedReadingsCount}: accuracy=${accuracy.toFixed(1)}m`);

          // Calculate raw speed in km/h
          const rawSpeed = position.coords.speed !== null
            ? Math.max(0, position.coords.speed * GPS_CONFIG.MS_TO_KMH)
            : 0.0;

          // Apply minimum speed threshold to filter out GPS noise when stationary
          const speed = rawSpeed < GPS_CONFIG.MIN_SPEED_THRESHOLD ? 0.0 : rawSpeed;

          elements.speedDisplay.textContent = speed.toFixed(1);
          updateGpsStatus(true);
          elements.gpsInfo.classList.remove('hidden');

          // Actualizar velocidad mÃ¡xima (use raw speed before threshold for max tracking)
          if (rawSpeed > maxSpeed) {
            maxSpeed = rawSpeed;
            elements.maxSpeed.textContent = maxSpeed.toFixed(1);
          }

          // Actualizar promedio
          speedReadings.push(speed);
          if (speedReadings.length > GPS_CONFIG.MAX_SPEED_READINGS) speedReadings.shift();
          const avgSpeed = (speedReadings.reduce((a, b) => a + b, 0) / speedReadings.length).toFixed(1);
          elements.avgSpeed.textContent = avgSpeed;

          // Voice announcement
          announceSpeed(speed);

          // Calcular direcciÃ³n/rumbo
          let bearing = 0;
          if (lastPosition && rawSpeed > 1) { // Solo si hay movimiento real
            bearing = calculateBearing(
              lastPosition.coords.latitude,
              lastPosition.coords.longitude,
              position.coords.latitude,
              position.coords.longitude
            );
          }

          elements.accuracy.textContent = Math.round(accuracy);
          elements.coords.textContent = `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`;

          // Send to WebSocket (only if not in visualizer mode)
          if (!visualizerMode && ws && ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify({
              type: 'speed',
              userId,
              userName: userName || 'Usuario',
              groupName: groupName || 'default',
              speed: speed,
              maxSpeed,
              lat: position.coords.latitude,
              lon: position.coords.longitude,
              bearing: Math.round(bearing),
              timestamp: Date.now()
            }));
          }
          
          lastPosition = position;
        },
        (error) => {
          let errorMsg = '';
          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMsg = t('permissionDenied');
              break;
            case error.POSITION_UNAVAILABLE:
              errorMsg = t('positionUnavailable');
              break;
            case error.TIMEOUT:
              errorMsg = t('timeout');
              break;
            default:
              errorMsg = t('gpsError') + error.message;
          }
          showError(errorMsg);
          updateGpsStatus(false);
        },
        options
      );

      isTracking = true;
      elements.trackButton.textContent = t('stopTracking');
      elements.trackButton.className = 'w-full bg-red-600 hover:bg-red-700 active:bg-red-800 text-white font-semibold py-3 px-6 rounded-lg transition-colors';
    }

    // Submit max speed record to server
    async function submitSpeedHistory() {
      if (maxSpeed > 0 && lastPosition) {
        try {
          const httpUrl = serverUrl.replace('wss://', 'https://').replace('ws://', 'http://');
          const response = await fetch(`${httpUrl}/api/speed-history`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              userId,
              userName: userName || 'Usuario',
              groupName: groupName || 'default',
              maxSpeed,
              latitude: lastPosition.coords.latitude,
              longitude: lastPosition.coords.longitude,
              timestamp: Date.now()
            })
          });

          if (response.ok) {
            console.log('âœ… Speed history record submitted successfully');
          } else {
            console.error('âŒ Failed to submit speed history:', response.status);
          }
        } catch (error) {
          console.error('âŒ Error submitting speed history:', error);
        }
      }
    }

    // Load speed history from server
    async function loadSpeedHistory() {
      try {
        elements.historyLoading.classList.remove('hidden');
        elements.historyEmpty.classList.add('hidden');
        elements.historyRecordsList.innerHTML = '';

        const httpUrl = serverUrl.replace('wss://', 'https://').replace('ws://', 'http://');

        // Load statistics
        const statsResponse = await fetch(`${httpUrl}/api/speed-history/${userId}/stats`);
        if (statsResponse.ok) {
          const statsData = await statsResponse.json();
          const stats = statsData.statistics;
          elements.historyTotalRecords.textContent = stats.total_records || '0';
          elements.historyHighestSpeed.textContent = parseFloat(stats.highest_speed || 0).toFixed(1);
          elements.historyAverageMax.textContent = parseFloat(stats.average_max_speed || 0).toFixed(1);
        }

        // Load history records
        const historyResponse = await fetch(`${httpUrl}/api/speed-history/${userId}?limit=50`);
        if (historyResponse.ok) {
          const historyData = await historyResponse.json();
          const records = historyData.records || [];

          elements.historyLoading.classList.add('hidden');

          if (records.length === 0) {
            elements.historyEmpty.classList.remove('hidden');
          } else {
            records.forEach(record => {
              const recordElement = document.createElement('div');
              recordElement.className = 'bg-white dark:bg-gray-700 rounded-lg p-3 border border-gray-200 dark:border-gray-600';
              recordElement.innerHTML = `
                <div class="flex justify-between items-start mb-1">
                  <div class="text-sm font-semibold text-gray-800 dark:text-white">${record.date}</div>
                  <div class="text-lg font-bold text-red-600 dark:text-red-400">${parseFloat(record.max_speed).toFixed(1)} km/h</div>
                </div>
                <div class="flex justify-between items-center text-xs text-gray-600 dark:text-gray-400">
                  <div>${record.time}</div>
                  <div>${parseFloat(record.latitude).toFixed(4)}, ${parseFloat(record.longitude).toFixed(4)}</div>
                </div>
                ${record.group_name && record.group_name !== 'default' ? `<div class="text-xs text-gray-500 dark:text-gray-500 mt-1">Group: ${record.group_name}</div>` : ''}
              `;
              elements.historyRecordsList.appendChild(recordElement);
            });
          }
        } else {
          throw new Error('Failed to load history');
        }
      } catch (error) {
        console.error('âŒ Error loading speed history:', error);
        elements.historyLoading.classList.add('hidden');
        elements.historyEmpty.classList.remove('hidden');
        elements.historyEmpty.textContent = 'Error loading history: ' + error.message;
      }
    }

    // Detener seguimiento
    function stopTracking() {
      console.log('â¹ï¸ DETENIENDO SEGUIMIENTO');

      // Submit max speed record before stopping
      submitSpeedHistory();

      if (watchId) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
      }

      if (ws) {
        ws.close();
        ws = null;
      }

      stopKeepAlive();
      releaseWakeLock();

      isTracking = false;
      reconnectAttempts = 0;
      updateGpsStatus(false);
      updateConnectionStatus(false);
      elements.speedDisplay.textContent = '0.0';
      elements.gpsInfo.style.display = 'none';
      
      // Cambiar visibilidad
      elements.configSection.classList.remove('hidden');
      elements.configSection.style.display = 'block';
      elements.statusSection.classList.add('hidden');
      elements.statusSection.style.display = 'none';
      
      // Restaurar botÃ³n iniciar a su estilo original
      elements.trackButton.textContent = t('startTracking');
      elements.trackButton.className = 'flex-1 bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-3 px-6 rounded-lg transition-colors';

      console.log('âœ… Status oculto, Config visible');
      console.log('âœ… SEGUIMIENTO DETENIDO');
    }

    // Eventos de los botones
    elements.trackButton.addEventListener('click', () => {
      startTracking();
    });

    elements.stopButton.addEventListener('click', () => {
      stopTracking();
    });

    // Limpiar al cerrar/recargar pÃ¡gina
    window.addEventListener('beforeunload', () => {
      if (isTracking) {
        stopTracking();
      }
    });

    console.log('âœ“ 3WB Tracker listo');
    console.log('ğŸ“± iOS:', isIOS, '| Standalone:', isStandalone);
  </script>
</body>
</html>
